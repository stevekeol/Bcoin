/*!
 * parser.js - packet parser for bcoin
 * Copyright (c) 2014-2015, Fedor Indutny (MIT License)
 * Copyright (c) 2014-2017, Christopher Jeffrey (MIT License).
 * https://github.com/bcoin-org/bcoin
 */ /* eslint nonblock-statement-body-position: "off" */'use strict';function cov_6t87v9468(){var path="E:\\Projects\\Test\\bcoin\\lib\\net\\parser.js";var hash="11f391393b5b970d65f4e6f066987847f1e817bb";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\Projects\\Test\\bcoin\\lib\\net\\parser.js",statementMap:{"0":{start:{line:12,column:15},end:{line:12,column:31}},"1":{start:{line:13,column:21},end:{line:13,column:38}},"2":{start:{line:14,column:17},end:{line:14,column:32}},"3":{start:{line:15,column:16},end:{line:15,column:46}},"4":{start:{line:16,column:16},end:{line:16,column:46}},"5":{start:{line:17,column:15},end:{line:17,column:34}},"6":{start:{line:18,column:16},end:{line:18,column:36}},"7":{start:{line:36,column:4},end:{line:36,column:12}},"8":{start:{line:38,column:4},end:{line:38,column:40}},"9":{start:{line:40,column:4},end:{line:40,column:22}},"10":{start:{line:41,column:4},end:{line:41,column:19}},"11":{start:{line:42,column:4},end:{line:42,column:22}},"12":{start:{line:43,column:4},end:{line:43,column:23}},"13":{start:{line:53,column:16},end:{line:53,column:45}},"14":{start:{line:54,column:4},end:{line:54,column:39}},"15":{start:{line:63,column:4},end:{line:63,column:30}},"16":{start:{line:64,column:4},end:{line:64,column:28}},"17":{start:{line:66,column:4},end:{line:83,column:5}},"18":{start:{line:67,column:20},end:{line:67,column:52}},"19":{start:{line:68,column:16},end:{line:68,column:17}},"20":{start:{line:70,column:6},end:{line:77,column:7}},"21":{start:{line:71,column:20},end:{line:71,column:52}},"22":{start:{line:72,column:8},end:{line:75,column:55}},"23":{start:{line:73,column:10},end:{line:73,column:31}},"24":{start:{line:75,column:10},end:{line:75,column:55}},"25":{start:{line:76,column:8},end:{line:76,column:19}},"26":{start:{line:79,column:6},end:{line:79,column:44}},"27":{start:{line:81,column:6},end:{line:81,column:33}},"28":{start:{line:82,column:6},end:{line:82,column:24}},"29":{start:{line:92,column:4},end:{line:92,column:46}},"30":{start:{line:94,column:4},end:{line:97,column:5}},"31":{start:{line:95,column:6},end:{line:95,column:43}},"32":{start:{line:96,column:6},end:{line:96,column:13}},"33":{start:{line:99,column:17},end:{line:99,column:37}},"34":{start:{line:100,column:21},end:{line:100,column:47}},"35":{start:{line:102,column:4},end:{line:107,column:5}},"36":{start:{line:103,column:6},end:{line:103,column:24}},"37":{start:{line:104,column:6},end:{line:104,column:25}},"38":{start:{line:105,column:6},end:{line:105,column:65}},"39":{start:{line:106,column:6},end:{line:106,column:13}},"40":{start:{line:110,column:4},end:{line:117,column:5}},"41":{start:{line:111,column:6},end:{line:111,column:57}},"42":{start:{line:113,column:6},end:{line:113,column:24}},"43":{start:{line:114,column:6},end:{line:114,column:25}},"44":{start:{line:115,column:6},end:{line:115,column:28}},"45":{start:{line:116,column:6},end:{line:116,column:13}},"46":{start:{line:119,column:4},end:{line:119,column:22}},"47":{start:{line:120,column:4},end:{line:120,column:23}},"48":{start:{line:122,column:4},end:{line:122,column:33}},"49":{start:{line:132,column:18},end:{line:132,column:44}},"50":{start:{line:134,column:4},end:{line:137,column:5}},"51":{start:{line:135,column:6},end:{line:135,column:65}},"52":{start:{line:136,column:6},end:{line:136,column:18}},"53":{start:{line:140,column:12},end:{line:140,column:13}},"54":{start:{line:141,column:4},end:{line:141,column:45}},"55":{start:{line:143,column:4},end:{line:146,column:5}},"56":{start:{line:144,column:6},end:{line:144,column:49}},"57":{start:{line:145,column:6},end:{line:145,column:18}},"58":{start:{line:148,column:16},end:{line:148,column:48}},"59":{start:{line:150,column:17},end:{line:150,column:44}},"60":{start:{line:152,column:4},end:{line:156,column:5}},"61":{start:{line:153,column:6},end:{line:153,column:24}},"62":{start:{line:154,column:6},end:{line:154,column:55}},"63":{start:{line:155,column:6},end:{line:155,column:18}},"64":{start:{line:158,column:4},end:{line:158,column:24}},"65":{start:{line:160,column:21},end:{line:160,column:48}},"66":{start:{line:162,column:4},end:{line:162,column:43}},"67":{start:{line:173,column:4},end:{line:173,column:38}},"68":{start:{line:189,column:4},end:{line:189,column:19}},"69":{start:{line:190,column:4},end:{line:190,column:21}},"70":{start:{line:191,column:4},end:{line:191,column:29}},"71":{start:{line:199,column:0},end:{line:199,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:35,column:2},end:{line:35,column:3}},loc:{start:{line:35,column:23},end:{line:44,column:3}},line:35},"1":{name:"(anonymous_1)",decl:{start:{line:52,column:2},end:{line:52,column:3}},loc:{start:{line:52,column:10},end:{line:55,column:3}},line:52},"2":{name:"(anonymous_2)",decl:{start:{line:62,column:2},end:{line:62,column:3}},loc:{start:{line:62,column:13},end:{line:84,column:3}},line:62},"3":{name:"(anonymous_3)",decl:{start:{line:91,column:2},end:{line:91,column:3}},loc:{start:{line:91,column:14},end:{line:123,column:3}},line:91},"4":{name:"(anonymous_4)",decl:{start:{line:131,column:2},end:{line:131,column:3}},loc:{start:{line:131,column:20},end:{line:163,column:3}},line:131},"5":{name:"(anonymous_5)",decl:{start:{line:172,column:2},end:{line:172,column:3}},loc:{start:{line:172,column:26},end:{line:174,column:3}},line:172},"6":{name:"(anonymous_6)",decl:{start:{line:188,column:2},end:{line:188,column:3}},loc:{start:{line:188,column:35},end:{line:192,column:3}},line:188}},branchMap:{"0":{loc:{start:{line:72,column:8},end:{line:75,column:55}},type:"if",locations:[{start:{line:72,column:8},end:{line:75,column:55}},{start:{line:72,column:8},end:{line:75,column:55}}],line:72},"1":{loc:{start:{line:94,column:4},end:{line:97,column:5}},type:"if",locations:[{start:{line:94,column:4},end:{line:97,column:5}},{start:{line:94,column:4},end:{line:97,column:5}}],line:94},"2":{loc:{start:{line:102,column:4},end:{line:107,column:5}},type:"if",locations:[{start:{line:102,column:4},end:{line:107,column:5}},{start:{line:102,column:4},end:{line:107,column:5}}],line:102},"3":{loc:{start:{line:134,column:4},end:{line:137,column:5}},type:"if",locations:[{start:{line:134,column:4},end:{line:137,column:5}},{start:{line:134,column:4},end:{line:137,column:5}}],line:134},"4":{loc:{start:{line:141,column:11},end:{line:141,column:38}},type:"binary-expr",locations:[{start:{line:141,column:11},end:{line:141,column:28}},{start:{line:141,column:32},end:{line:141,column:38}}],line:141},"5":{loc:{start:{line:143,column:4},end:{line:146,column:5}},type:"if",locations:[{start:{line:143,column:4},end:{line:146,column:5}},{start:{line:143,column:4},end:{line:146,column:5}}],line:143},"6":{loc:{start:{line:152,column:4},end:{line:156,column:5}},type:"if",locations:[{start:{line:152,column:4},end:{line:156,column:5}},{start:{line:152,column:4},end:{line:156,column:5}}],line:152}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"11f391393b5b970d65f4e6f066987847f1e817bb"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_6t87v9468=function(){return actualCoverage;};}return actualCoverage;}cov_6t87v9468();const assert=(cov_6t87v9468().s[0]++,require('bsert'));const EventEmitter=(cov_6t87v9468().s[1]++,require('events'));const{format}=(cov_6t87v9468().s[2]++,require('util'));const Network=(cov_6t87v9468().s[3]++,require('../protocol/network'));const hash256=(cov_6t87v9468().s[4]++,require('bcrypto/lib/hash256'));const common=(cov_6t87v9468().s[5]++,require('./common'));const packets=(cov_6t87v9468().s[6]++,require('./packets'));/**
 * Protocol Message Parser
 * @alias module:net.Parser
 * @extends EventEmitter
 * @emits Parser#error
 * @emits Parser#packet
 */class Parser extends EventEmitter{/**
   * Create a parser.
   * @constructor
   * @param {Network} network
   */constructor(network){cov_6t87v9468().f[0]++;cov_6t87v9468().s[7]++;super();cov_6t87v9468().s[8]++;this.network=Network.get(network);cov_6t87v9468().s[9]++;this.pending=[];cov_6t87v9468().s[10]++;this.total=0;cov_6t87v9468().s[11]++;this.waiting=24;cov_6t87v9468().s[12]++;this.header=null;}/**
   * Emit an error.
   * @private
   * @param {...String} msg
   */error(){cov_6t87v9468().f[1]++;const msg=(cov_6t87v9468().s[13]++,format.apply(null,arguments));cov_6t87v9468().s[14]++;this.emit('error',new Error(msg));}/**
   * Feed data to the parser.
   * @param {Buffer} data
   */feed(data){cov_6t87v9468().f[2]++;cov_6t87v9468().s[15]++;this.total+=data.length;cov_6t87v9468().s[16]++;this.pending.push(data);cov_6t87v9468().s[17]++;while(this.total>=this.waiting){const chunk=(cov_6t87v9468().s[18]++,Buffer.allocUnsafe(this.waiting));let off=(cov_6t87v9468().s[19]++,0);cov_6t87v9468().s[20]++;while(off<chunk.length){const len=(cov_6t87v9468().s[21]++,this.pending[0].copy(chunk,off));cov_6t87v9468().s[22]++;if(len===this.pending[0].length){cov_6t87v9468().b[0][0]++;cov_6t87v9468().s[23]++;this.pending.shift();}else{cov_6t87v9468().b[0][1]++;cov_6t87v9468().s[24]++;this.pending[0]=this.pending[0].slice(len);}cov_6t87v9468().s[25]++;off+=len;}cov_6t87v9468().s[26]++;assert.strictEqual(off,chunk.length);cov_6t87v9468().s[27]++;this.total-=chunk.length;cov_6t87v9468().s[28]++;this.parse(chunk);}}/**
   * Parse a fully-buffered chunk.
   * @param {Buffer} chunk
   */parse(data){cov_6t87v9468().f[3]++;cov_6t87v9468().s[29]++;assert(data.length<=common.MAX_MESSAGE);cov_6t87v9468().s[30]++;if(!this.header){cov_6t87v9468().b[1][0]++;cov_6t87v9468().s[31]++;this.header=this.parseHeader(data);cov_6t87v9468().s[32]++;return;}else{cov_6t87v9468().b[1][1]++;}const hash=(cov_6t87v9468().s[33]++,hash256.digest(data));const checksum=(cov_6t87v9468().s[34]++,hash.readUInt32LE(0,true));cov_6t87v9468().s[35]++;if(checksum!==this.header.checksum){cov_6t87v9468().b[2][0]++;cov_6t87v9468().s[36]++;this.waiting=24;cov_6t87v9468().s[37]++;this.header=null;cov_6t87v9468().s[38]++;this.error('Invalid checksum: %s.',checksum.toString(16));cov_6t87v9468().s[39]++;return;}else{cov_6t87v9468().b[2][1]++;}let payload;cov_6t87v9468().s[40]++;try{cov_6t87v9468().s[41]++;payload=this.parsePayload(this.header.cmd,data);}catch(e){cov_6t87v9468().s[42]++;this.waiting=24;cov_6t87v9468().s[43]++;this.header=null;cov_6t87v9468().s[44]++;this.emit('error',e);cov_6t87v9468().s[45]++;return;}cov_6t87v9468().s[46]++;this.waiting=24;cov_6t87v9468().s[47]++;this.header=null;cov_6t87v9468().s[48]++;this.emit('packet',payload);}/**
   * Parse buffered packet header.
   * @param {Buffer} data - Header.
   * @returns {Header}
   */parseHeader(data){cov_6t87v9468().f[4]++;const magic=(cov_6t87v9468().s[49]++,data.readUInt32LE(0,true));cov_6t87v9468().s[50]++;if(magic!==this.network.magic){cov_6t87v9468().b[3][0]++;cov_6t87v9468().s[51]++;this.error('Invalid magic value: %s.',magic.toString(16));cov_6t87v9468().s[52]++;return null;}else{cov_6t87v9468().b[3][1]++;}// Count length of the cmd.
let i=(cov_6t87v9468().s[53]++,0);cov_6t87v9468().s[54]++;for(;(cov_6t87v9468().b[4][0]++,data[i+4]!==0)&&(cov_6t87v9468().b[4][1]++,i<12);i++){;}cov_6t87v9468().s[55]++;if(i===12){cov_6t87v9468().b[5][0]++;cov_6t87v9468().s[56]++;this.error('Non NULL-terminated command.');cov_6t87v9468().s[57]++;return null;}else{cov_6t87v9468().b[5][1]++;}const cmd=(cov_6t87v9468().s[58]++,data.toString('ascii',4,4+i));const size=(cov_6t87v9468().s[59]++,data.readUInt32LE(16,true));cov_6t87v9468().s[60]++;if(size>common.MAX_MESSAGE){cov_6t87v9468().b[6][0]++;cov_6t87v9468().s[61]++;this.waiting=24;cov_6t87v9468().s[62]++;this.error('Packet length too large: %d.',size);cov_6t87v9468().s[63]++;return null;}else{cov_6t87v9468().b[6][1]++;}cov_6t87v9468().s[64]++;this.waiting=size;const checksum=(cov_6t87v9468().s[65]++,data.readUInt32LE(20,true));cov_6t87v9468().s[66]++;return new Header(cmd,size,checksum);}/**
   * Parse a payload.
   * @param {String} cmd - Packet type.
   * @param {Buffer} data - Payload.
   * @returns {Object}
   */parsePayload(cmd,data){cov_6t87v9468().f[5]++;cov_6t87v9468().s[67]++;return packets.fromRaw(cmd,data);}}/**
 * Packet Header
 * @ignore
 */class Header{/**
   * Create a header.
   * @constructor
   */constructor(cmd,size,checksum){cov_6t87v9468().f[6]++;cov_6t87v9468().s[68]++;this.cmd=cmd;cov_6t87v9468().s[69]++;this.size=size;cov_6t87v9468().s[70]++;this.checksum=checksum;}}/*
 * Expose
 */cov_6t87v9468().s[71]++;module.exports=Parser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlci5qcyJdLCJuYW1lcyI6WyJhc3NlcnQiLCJyZXF1aXJlIiwiRXZlbnRFbWl0dGVyIiwiZm9ybWF0IiwiTmV0d29yayIsImhhc2gyNTYiLCJjb21tb24iLCJwYWNrZXRzIiwiUGFyc2VyIiwiY29uc3RydWN0b3IiLCJuZXR3b3JrIiwiZ2V0IiwicGVuZGluZyIsInRvdGFsIiwid2FpdGluZyIsImhlYWRlciIsImVycm9yIiwibXNnIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJlbWl0IiwiRXJyb3IiLCJmZWVkIiwiZGF0YSIsImxlbmd0aCIsInB1c2giLCJjaHVuayIsIkJ1ZmZlciIsImFsbG9jVW5zYWZlIiwib2ZmIiwibGVuIiwiY29weSIsInNoaWZ0Iiwic2xpY2UiLCJzdHJpY3RFcXVhbCIsInBhcnNlIiwiTUFYX01FU1NBR0UiLCJwYXJzZUhlYWRlciIsImhhc2giLCJkaWdlc3QiLCJjaGVja3N1bSIsInJlYWRVSW50MzJMRSIsInRvU3RyaW5nIiwicGF5bG9hZCIsInBhcnNlUGF5bG9hZCIsImNtZCIsImUiLCJtYWdpYyIsImkiLCJzaXplIiwiSGVhZGVyIiwiZnJvbVJhdyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHLENBRUEsb0RBRUEsYSwraFBBTVk7eUZBSlosS0FBTUEsQ0FBQUEsTUFBTSx5QkFBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUMsQ0FBQUEsWUFBWSx5QkFBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFsQixDQUNBLEtBQU0sQ0FBQ0UsTUFBRCwwQkFBV0YsT0FBTyxDQUFDLE1BQUQsQ0FBbEIsQ0FBTixDQUNBLEtBQU1HLENBQUFBLE9BQU8seUJBQUdILE9BQU8sQ0FBQyxxQkFBRCxDQUFWLENBQWIsQ0FDQSxLQUFNSSxDQUFBQSxPQUFPLHlCQUFHSixPQUFPLENBQUMscUJBQUQsQ0FBVixDQUFiLENBQ0EsS0FBTUssQ0FBQUEs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Q0E7QUFDQTtBQUNBLEtBRUVJLFlBQVksQ0FBQ0MsR0FBRCxDQUFNdEIsSUFBTixDQUFZLGdEQUN0QixNQUFPaEIsQ0FBQUEsT0FBTyxDQUFDNEMsT0FBUixDQUFnQk4sR0FBaEIsQ0FBcUJ0QixJQUFyQixDQUFQLENBQ0QsQ0FsSitCLENBcUpsQztBQUNBO0FBQ0E7QUFDQSxHQUVBLEtBQU0yQixDQUFBQSxNQUFPLENBQ1g7QUFDRjtBQUNBO0FBQ0EsS0FFRXpDLFdBQVcsQ0FBQ29DLEdBQUQsQ0FBTUksSUFBTixDQUFZVCxRQUFaLENBQXNCLGdEQUMvQixLQUFLSyxHQUFMLENBQVdBLEdBQVgsQ0FEK0Isd0JBRS9CLEtBQUtJLElBQUwsQ0FBWUEsSUFBWixDQUYrQix3QkFHL0IsS0FBS1QsUUFBTCxDQUFnQkEsUUFBaEIsQ0FDRCxDQVZVLENBYWI7QUFDQTtBQUNBLEcsd0JBRUFZLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQjdDLE1BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXHJcbiAqIHBhcnNlci5qcyAtIHBhY2tldCBwYXJzZXIgZm9yIGJjb2luXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNC0yMDE1LCBGZWRvciBJbmR1dG55IChNSVQgTGljZW5zZSlcclxuICogQ29weXJpZ2h0IChjKSAyMDE0LTIwMTcsIENocmlzdG9waGVyIEplZmZyZXkgKE1JVCBMaWNlbnNlKS5cclxuICogaHR0cHM6Ly9naXRodWIuY29tL2Jjb2luLW9yZy9iY29pblxyXG4gKi9cclxuXHJcbi8qIGVzbGludCBub25ibG9jay1zdGF0ZW1lbnQtYm9keS1wb3NpdGlvbjogXCJvZmZcIiAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZSgnYnNlcnQnKTtcclxuY29uc3QgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnZXZlbnRzJyk7XHJcbmNvbnN0IHtmb3JtYXR9ID0gcmVxdWlyZSgndXRpbCcpO1xyXG5jb25zdCBOZXR3b3JrID0gcmVxdWlyZSgnLi4vcHJvdG9jb2wvbmV0d29yaycpO1xyXG5jb25zdCBoYXNoMjU2ID0gcmVxdWlyZSgnYmNyeXB0by9saWIvaGFzaDI1NicpO1xyXG5jb25zdCBjb21tb24gPSByZXF1aXJlKCcuL2NvbW1vbicpO1xyXG5jb25zdCBwYWNrZXRzID0gcmVxdWlyZSgnLi9wYWNrZXRzJyk7XHJcblxyXG4vKipcclxuICogUHJvdG9jb2wgTWVzc2FnZSBQYXJzZXJcclxuICogQGFsaWFzIG1vZHVsZTpuZXQuUGFyc2VyXHJcbiAqIEBleHRlbmRzIEV2ZW50RW1pdHRlclxyXG4gKiBAZW1pdHMgUGFyc2VyI2Vycm9yXHJcbiAqIEBlbWl0cyBQYXJzZXIjcGFja2V0XHJcbiAqL1xyXG5cclxuY2xhc3MgUGFyc2VyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBwYXJzZXIuXHJcbiAgICogQGNvbnN0cnVjdG9yXHJcbiAgICogQHBhcmFtIHtOZXR3b3JrfSBuZXR3b3JrXHJcbiAgICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKG5ldHdvcmspIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5uZXR3b3JrID0gTmV0d29yay5nZXQobmV0d29yayk7XHJcblxyXG4gICAgdGhpcy5wZW5kaW5nID0gW107XHJcbiAgICB0aGlzLnRvdGFsID0gMDtcclxuICAgIHRoaXMud2FpdGluZyA9IDI0O1xyXG4gICAgdGhpcy5oZWFkZXIgPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRW1pdCBhbiBlcnJvci5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBwYXJhbSB7Li4uU3RyaW5nfSBtc2dcclxuICAgKi9cclxuXHJcbiAgZXJyb3IoKSB7XHJcbiAgICBjb25zdCBtc2cgPSBmb3JtYXQuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcclxuICAgIHRoaXMuZW1pdCgnZXJyb3InLCBuZXcgRXJyb3IobXNnKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZWVkIGRhdGEgdG8gdGhlIHBhcnNlci5cclxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gZGF0YVxyXG4gICAqL1xyXG5cclxuICBmZWVkKGRhdGEpIHtcclxuICAgIHRoaXMudG90YWwgKz0gZGF0YS5sZW5ndGg7XHJcbiAgICB0aGlzLnBlbmRpbmcucHVzaChkYXRhKTtcclxuXHJcbiAgICB3aGlsZSAodGhpcy50b3RhbCA+PSB0aGlzLndhaXRpbmcpIHtcclxuICAgICAgY29uc3QgY2h1bmsgPSBCdWZmZXIuYWxsb2NVbnNhZmUodGhpcy53YWl0aW5nKTtcclxuICAgICAgbGV0IG9mZiA9IDA7XHJcblxyXG4gICAgICB3aGlsZSAob2ZmIDwgY2h1bmsubGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc3QgbGVuID0gdGhpcy5wZW5kaW5nWzBdLmNvcHkoY2h1bmssIG9mZik7XHJcbiAgICAgICAgaWYgKGxlbiA9PT0gdGhpcy5wZW5kaW5nWzBdLmxlbmd0aClcclxuICAgICAgICAgIHRoaXMucGVuZGluZy5zaGlmdCgpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgIHRoaXMucGVuZGluZ1swXSA9IHRoaXMucGVuZGluZ1swXS5zbGljZShsZW4pO1xyXG4gICAgICAgIG9mZiArPSBsZW47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChvZmYsIGNodW5rLmxlbmd0aCk7XHJcblxyXG4gICAgICB0aGlzLnRvdGFsIC09IGNodW5rLmxlbmd0aDtcclxuICAgICAgdGhpcy5wYXJzZShjaHVuayk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQYXJzZSBhIGZ1bGx5LWJ1ZmZlcmVkIGNodW5rLlxyXG4gICAqIEBwYXJhbSB7QnVmZmVyfSBjaHVua1xyXG4gICAqL1xyXG5cclxuICBwYXJzZShkYXRhKSB7XHJcbiAgICBhc3NlcnQoZGF0YS5sZW5ndGggPD0gY29tbW9uLk1BWF9NRVNTQUdFKTtcclxuXHJcbiAgICBpZiAoIXRoaXMuaGVhZGVyKSB7XHJcbiAgICAgIHRoaXMuaGVhZGVyID0gdGhpcy5wYXJzZUhlYWRlcihkYXRhKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhhc2ggPSBoYXNoMjU2LmRpZ2VzdChkYXRhKTtcclxuICAgIGNvbnN0IGNoZWNrc3VtID0gaGFzaC5yZWFkVUludDMyTEUoMCwgdHJ1ZSk7XHJcblxyXG4gICAgaWYgKGNoZWNrc3VtICE9PSB0aGlzLmhlYWRlci5jaGVja3N1bSkge1xyXG4gICAgICB0aGlzLndhaXRpbmcgPSAyNDtcclxuICAgICAgdGhpcy5oZWFkZXIgPSBudWxsO1xyXG4gICAgICB0aGlzLmVycm9yKCdJbnZhbGlkIGNoZWNrc3VtOiAlcy4nLCBjaGVja3N1bS50b1N0cmluZygxNikpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHBheWxvYWQ7XHJcbiAgICB0cnkge1xyXG4gICAgICBwYXlsb2FkID0gdGhpcy5wYXJzZVBheWxvYWQodGhpcy5oZWFkZXIuY21kLCBkYXRhKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgdGhpcy53YWl0aW5nID0gMjQ7XHJcbiAgICAgIHRoaXMuaGVhZGVyID0gbnVsbDtcclxuICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIGUpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy53YWl0aW5nID0gMjQ7XHJcbiAgICB0aGlzLmhlYWRlciA9IG51bGw7XHJcblxyXG4gICAgdGhpcy5lbWl0KCdwYWNrZXQnLCBwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBhcnNlIGJ1ZmZlcmVkIHBhY2tldCBoZWFkZXIuXHJcbiAgICogQHBhcmFtIHtCdWZmZXJ9IGRhdGEgLSBIZWFkZXIuXHJcbiAgICogQHJldHVybnMge0hlYWRlcn1cclxuICAgKi9cclxuXHJcbiAgcGFyc2VIZWFkZXIoZGF0YSkge1xyXG4gICAgY29uc3QgbWFnaWMgPSBkYXRhLnJlYWRVSW50MzJMRSgwLCB0cnVlKTtcclxuXHJcbiAgICBpZiAobWFnaWMgIT09IHRoaXMubmV0d29yay5tYWdpYykge1xyXG4gICAgICB0aGlzLmVycm9yKCdJbnZhbGlkIG1hZ2ljIHZhbHVlOiAlcy4nLCBtYWdpYy50b1N0cmluZygxNikpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb3VudCBsZW5ndGggb2YgdGhlIGNtZC5cclxuICAgIGxldCBpID0gMDtcclxuICAgIGZvciAoOyBkYXRhW2kgKyA0XSAhPT0gMCAmJiBpIDwgMTI7IGkrKyk7XHJcblxyXG4gICAgaWYgKGkgPT09IDEyKSB7XHJcbiAgICAgIHRoaXMuZXJyb3IoJ05vbiBOVUxMLXRlcm1pbmF0ZWQgY29tbWFuZC4nKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY21kID0gZGF0YS50b1N0cmluZygnYXNjaWknLCA0LCA0ICsgaSk7XHJcblxyXG4gICAgY29uc3Qgc2l6ZSA9IGRhdGEucmVhZFVJbnQzMkxFKDE2LCB0cnVlKTtcclxuXHJcbiAgICBpZiAoc2l6ZSA+IGNvbW1vbi5NQVhfTUVTU0FHRSkge1xyXG4gICAgICB0aGlzLndhaXRpbmcgPSAyNDtcclxuICAgICAgdGhpcy5lcnJvcignUGFja2V0IGxlbmd0aCB0b28gbGFyZ2U6ICVkLicsIHNpemUpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLndhaXRpbmcgPSBzaXplO1xyXG5cclxuICAgIGNvbnN0IGNoZWNrc3VtID0gZGF0YS5yZWFkVUludDMyTEUoMjAsIHRydWUpO1xyXG5cclxuICAgIHJldHVybiBuZXcgSGVhZGVyKGNtZCwgc2l6ZSwgY2hlY2tzdW0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGFyc2UgYSBwYXlsb2FkLlxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBjbWQgLSBQYWNrZXQgdHlwZS5cclxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gZGF0YSAtIFBheWxvYWQuXHJcbiAgICogQHJldHVybnMge09iamVjdH1cclxuICAgKi9cclxuXHJcbiAgcGFyc2VQYXlsb2FkKGNtZCwgZGF0YSkge1xyXG4gICAgcmV0dXJuIHBhY2tldHMuZnJvbVJhdyhjbWQsIGRhdGEpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFBhY2tldCBIZWFkZXJcclxuICogQGlnbm9yZVxyXG4gKi9cclxuXHJcbmNsYXNzIEhlYWRlciB7XHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgaGVhZGVyLlxyXG4gICAqIEBjb25zdHJ1Y3RvclxyXG4gICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcihjbWQsIHNpemUsIGNoZWNrc3VtKSB7XHJcbiAgICB0aGlzLmNtZCA9IGNtZDtcclxuICAgIHRoaXMuc2l6ZSA9IHNpemU7XHJcbiAgICB0aGlzLmNoZWNrc3VtID0gY2hlY2tzdW07XHJcbiAgfVxyXG59XHJcblxyXG4vKlxyXG4gKiBFeHBvc2VcclxuICovXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFBhcnNlcjtcclxuIl19