/*!
 * master.js - master process for bcoin
 * Copyright (c) 2014-2015, Fedor Indutny (MIT License)
 * Copyright (c) 2014-2017, Christopher Jeffrey (MIT License).
 * https://github.com/bcoin-org/bcoin
 */'use strict';function cov_m2llyef2f(){var path="E:\\Projects\\Test\\bcoin\\lib\\workers\\master.js";var hash="4f5a64024a4342f5c8b89c7e3d27b990d15fa5d9";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\Projects\\Test\\bcoin\\lib\\workers\\master.js",statementMap:{"0":{start:{line:10,column:15},end:{line:10,column:31}},"1":{start:{line:11,column:21},end:{line:11,column:38}},"2":{start:{line:12,column:17},end:{line:12,column:32}},"3":{start:{line:13,column:16},end:{line:13,column:46}},"4":{start:{line:14,column:13},end:{line:14,column:30}},"5":{start:{line:15,column:15},end:{line:15,column:34}},"6":{start:{line:16,column:15},end:{line:16,column:34}},"7":{start:{line:17,column:16},end:{line:17,column:36}},"8":{start:{line:18,column:15},end:{line:18,column:34}},"9":{start:{line:34,column:4},end:{line:34,column:12}},"10":{start:{line:36,column:4},end:{line:36,column:31}},"11":{start:{line:37,column:4},end:{line:37,column:31}},"12":{start:{line:38,column:4},end:{line:38,column:31}},"13":{start:{line:39,column:4},end:{line:39,column:27}},"14":{start:{line:40,column:4},end:{line:40,column:23}},"15":{start:{line:42,column:4},end:{line:42,column:16}},"16":{start:{line:51,column:4},end:{line:53,column:7}},"17":{start:{line:52,column:6},end:{line:52,column:29}},"18":{start:{line:55,column:4},end:{line:57,column:7}},"19":{start:{line:56,column:6},end:{line:56,column:30}},"20":{start:{line:59,column:4},end:{line:62,column:7}},"21":{start:{line:60,column:6},end:{line:60,column:46}},"22":{start:{line:61,column:6},end:{line:61,column:45}},"23":{start:{line:61,column:23},end:{line:61,column:37}},"24":{start:{line:64,column:4},end:{line:66,column:7}},"25":{start:{line:65,column:6},end:{line:65,column:30}},"26":{start:{line:68,column:4},end:{line:70,column:7}},"27":{start:{line:69,column:6},end:{line:69,column:34}},"28":{start:{line:79,column:4},end:{line:79,column:48}},"29":{start:{line:80,column:4},end:{line:80,column:39}},"30":{start:{line:89,column:4},end:{line:89,column:32}},"31":{start:{line:99,column:4},end:{line:99,column:35}},"32":{start:{line:109,column:4},end:{line:109,column:50}},"33":{start:{line:120,column:4},end:{line:120,column:53}},"34":{start:{line:128,column:4},end:{line:128,column:33}},"35":{start:{line:138,column:17},end:{line:138,column:46}},"36":{start:{line:139,column:4},end:{line:139,column:43}},"37":{start:{line:147,column:4},end:{line:147,column:50}},"38":{start:{line:149,column:4},end:{line:149,column:26}},"39":{start:{line:151,column:4},end:{line:153,column:7}},"40":{start:{line:152,column:6},end:{line:152,column:46}},"41":{start:{line:155,column:4},end:{line:161,column:7}},"42":{start:{line:156,column:6},end:{line:160,column:7}},"43":{start:{line:157,column:8},end:{line:157,column:34}},"44":{start:{line:159,column:8},end:{line:159,column:30}},"45":{start:{line:173,column:4},end:{line:189,column:5}},"46":{start:{line:175,column:8},end:{line:175,column:32}},"47":{start:{line:176,column:8},end:{line:176,column:14}},"48":{start:{line:178,column:8},end:{line:178,column:41}},"49":{start:{line:179,column:8},end:{line:179,column:35}},"50":{start:{line:180,column:8},end:{line:180,column:14}},"51":{start:{line:182,column:8},end:{line:182,column:41}},"52":{start:{line:183,column:8},end:{line:183,column:14}},"53":{start:{line:185,column:8},end:{line:185,column:38}},"54":{start:{line:186,column:8},end:{line:186,column:30}},"55":{start:{line:187,column:8},end:{line:187,column:26}},"56":{start:{line:188,column:8},end:{line:188,column:14}},"57":{start:{line:197,column:0},end:{line:197,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:33,column:2},end:{line:33,column:3}},loc:{start:{line:33,column:16},end:{line:43,column:3}},line:33},"1":{name:"(anonymous_1)",decl:{start:{line:50,column:2},end:{line:50,column:3}},loc:{start:{line:50,column:9},end:{line:71,column:3}},line:50},"2":{name:"(anonymous_2)",decl:{start:{line:51,column:27},end:{line:51,column:28}},loc:{start:{line:51,column:37},end:{line:53,column:5}},line:51},"3":{name:"(anonymous_3)",decl:{start:{line:55,column:28},end:{line:55,column:29}},loc:{start:{line:55,column:37},end:{line:57,column:5}},line:55},"4":{name:"(anonymous_4)",decl:{start:{line:59,column:32},end:{line:59,column:33}},loc:{start:{line:59,column:41},end:{line:62,column:5}},line:59},"5":{name:"(anonymous_5)",decl:{start:{line:61,column:17},end:{line:61,column:18}},loc:{start:{line:61,column:23},end:{line:61,column:37}},line:61},"6":{name:"(anonymous_6)",decl:{start:{line:64,column:28},end:{line:64,column:29}},loc:{start:{line:64,column:37},end:{line:66,column:5}},line:64},"7":{name:"(anonymous_7)",decl:{start:{line:68,column:29},end:{line:68,column:30}},loc:{start:{line:68,column:41},end:{line:70,column:5}},line:68},"8":{name:"(anonymous_8)",decl:{start:{line:78,column:2},end:{line:78,column:3}},loc:{start:{line:78,column:14},end:{line:81,column:3}},line:78},"9":{name:"(anonymous_9)",decl:{start:{line:88,column:2},end:{line:88,column:3}},loc:{start:{line:88,column:15},end:{line:90,column:3}},line:88},"10":{name:"(anonymous_10)",decl:{start:{line:98,column:2},end:{line:98,column:3}},loc:{start:{line:98,column:14},end:{line:100,column:3}},line:98},"11":{name:"(anonymous_11)",decl:{start:{line:108,column:2},end:{line:108,column:3}},loc:{start:{line:108,column:15},end:{line:110,column:3}},line:108},"12":{name:"(anonymous_12)",decl:{start:{line:119,column:2},end:{line:119,column:3}},loc:{start:{line:119,column:22},end:{line:121,column:3}},line:119},"13":{name:"(anonymous_13)",decl:{start:{line:127,column:2},end:{line:127,column:3}},loc:{start:{line:127,column:12},end:{line:129,column:3}},line:127},"14":{name:"(anonymous_14)",decl:{start:{line:137,column:2},end:{line:137,column:3}},loc:{start:{line:137,column:8},end:{line:140,column:3}},line:137},"15":{name:"(anonymous_15)",decl:{start:{line:146,column:2},end:{line:146,column:3}},loc:{start:{line:146,column:11},end:{line:162,column:3}},line:146},"16":{name:"(anonymous_16)",decl:{start:{line:151,column:21},end:{line:151,column:22}},loc:{start:{line:151,column:30},end:{line:153,column:5}},line:151},"17":{name:"(anonymous_17)",decl:{start:{line:155,column:22},end:{line:155,column:23}},loc:{start:{line:155,column:34},end:{line:161,column:5}},line:155},"18":{name:"(anonymous_18)",decl:{start:{line:170,column:2},end:{line:170,column:3}},loc:{start:{line:170,column:23},end:{line:190,column:3}},line:170}},branchMap:{"0":{loc:{start:{line:173,column:4},end:{line:189,column:5}},type:"switch",locations:[{start:{line:174,column:6},end:{line:176,column:14}},{start:{line:177,column:6},end:{line:180,column:14}},{start:{line:181,column:6},end:{line:183,column:14}},{start:{line:184,column:6},end:{line:188,column:14}}],line:173}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},b:{"0":[0,0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"4f5a64024a4342f5c8b89c7e3d27b990d15fa5d9"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_m2llyef2f=function(){return actualCoverage;};}return actualCoverage;}cov_m2llyef2f();const assert=(cov_m2llyef2f().s[0]++,require('bsert'));const EventEmitter=(cov_m2llyef2f().s[1]++,require('events'));const{format}=(cov_m2llyef2f().s[2]++,require('util'));const Network=(cov_m2llyef2f().s[3]++,require('../protocol/network'));const jobs=(cov_m2llyef2f().s[4]++,require('./jobs'));const Parser=(cov_m2llyef2f().s[5]++,require('./parser'));const Framer=(cov_m2llyef2f().s[6]++,require('./framer'));const packets=(cov_m2llyef2f().s[7]++,require('./packets'));const Parent=(cov_m2llyef2f().s[8]++,require('./parent'));/**
 * Master
 * Represents the master process.
 * @alias module:workers.Master
 * @extends EventEmitter
 */class Master extends EventEmitter{/**
   * Create the master process.
   * @constructor
   */constructor(){cov_m2llyef2f().f[0]++;cov_m2llyef2f().s[9]++;super();cov_m2llyef2f().s[10]++;this.parent=new Parent();cov_m2llyef2f().s[11]++;this.framer=new Framer();cov_m2llyef2f().s[12]++;this.parser=new Parser();cov_m2llyef2f().s[13]++;this.listening=false;cov_m2llyef2f().s[14]++;this.color=false;cov_m2llyef2f().s[15]++;this.init();}/**
   * Initialize master. Bind events.
   * @private
   */init(){cov_m2llyef2f().f[1]++;cov_m2llyef2f().s[16]++;this.parent.on('data',data=>{cov_m2llyef2f().f[2]++;cov_m2llyef2f().s[17]++;this.parser.feed(data);});cov_m2llyef2f().s[18]++;this.parent.on('error',err=>{cov_m2llyef2f().f[3]++;cov_m2llyef2f().s[19]++;this.emit('error',err);});cov_m2llyef2f().s[20]++;this.parent.on('exception',err=>{cov_m2llyef2f().f[4]++;cov_m2llyef2f().s[21]++;this.send(new packets.ErrorPacket(err));cov_m2llyef2f().s[22]++;setTimeout(()=>{cov_m2llyef2f().f[5]++;cov_m2llyef2f().s[23]++;return this.destroy();},1000);});cov_m2llyef2f().s[24]++;this.parser.on('error',err=>{cov_m2llyef2f().f[6]++;cov_m2llyef2f().s[25]++;this.emit('error',err);});cov_m2llyef2f().s[26]++;this.parser.on('packet',packet=>{cov_m2llyef2f().f[7]++;cov_m2llyef2f().s[27]++;this.emit('packet',packet);});}/**
   * Set environment.
   * @param {Object} env
   */setEnv(env){cov_m2llyef2f().f[8]++;cov_m2llyef2f().s[28]++;this.color=env.BCOIN_WORKER_ISTTY==='1';cov_m2llyef2f().s[29]++;this.set(env.BCOIN_WORKER_NETWORK);}/**
   * Set primary network.
   * @param {NetworkType|Network} network
   */set(network){cov_m2llyef2f().f[9]++;cov_m2llyef2f().s[30]++;return Network.set(network);}/**
   * Send data to worker.
   * @param {Buffer} data
   * @returns {Boolean}
   */write(data){cov_m2llyef2f().f[10]++;cov_m2llyef2f().s[31]++;return this.parent.write(data);}/**
   * Frame and send a packet.
   * @param {Packet} packet
   * @returns {Boolean}
   */send(packet){cov_m2llyef2f().f[11]++;cov_m2llyef2f().s[32]++;return this.write(this.framer.packet(packet));}/**
   * Emit an event on the worker side.
   * @param {String} event
   * @param {...Object} arg
   * @returns {Boolean}
   */sendEvent(...items){cov_m2llyef2f().f[12]++;cov_m2llyef2f().s[33]++;return this.send(new packets.EventPacket(items));}/**
   * Destroy the worker.
   */destroy(){cov_m2llyef2f().f[13]++;cov_m2llyef2f().s[34]++;return this.parent.destroy();}/**
   * Write a message to stdout in the master process.
   * @param {Object|String} obj
   * @param {...String} args
   */log(){cov_m2llyef2f().f[14]++;const text=(cov_m2llyef2f().s[35]++,format.apply(null,arguments));cov_m2llyef2f().s[36]++;this.send(new packets.LogPacket(text));}/**
   * Listen for messages from master process (only if worker).
   */listen(){cov_m2llyef2f().f[15]++;cov_m2llyef2f().s[37]++;assert(!this.listening,'Already listening.');cov_m2llyef2f().s[38]++;this.listening=true;cov_m2llyef2f().s[39]++;this.on('error',err=>{cov_m2llyef2f().f[16]++;cov_m2llyef2f().s[40]++;this.send(new packets.ErrorPacket(err));});cov_m2llyef2f().s[41]++;this.on('packet',packet=>{cov_m2llyef2f().f[17]++;cov_m2llyef2f().s[42]++;try{cov_m2llyef2f().s[43]++;this.handlePacket(packet);}catch(e){cov_m2llyef2f().s[44]++;this.emit('error',e);}});}/**
   * Handle packet.
   * @private
   * @param {Packet}
   */handlePacket(packet){cov_m2llyef2f().f[18]++;let result;cov_m2llyef2f().s[45]++;switch(packet.cmd){case packets.types.ENV:cov_m2llyef2f().b[0][0]++;cov_m2llyef2f().s[46]++;this.setEnv(packet.env);cov_m2llyef2f().s[47]++;break;case packets.types.EVENT:cov_m2llyef2f().b[0][1]++;cov_m2llyef2f().s[48]++;this.emit('event',packet.items);cov_m2llyef2f().s[49]++;this.emit(...packet.items);cov_m2llyef2f().s[50]++;break;case packets.types.ERROR:cov_m2llyef2f().b[0][2]++;cov_m2llyef2f().s[51]++;this.emit('error',packet.error);cov_m2llyef2f().s[52]++;break;default:cov_m2llyef2f().b[0][3]++;cov_m2llyef2f().s[53]++;result=jobs.execute(packet);cov_m2llyef2f().s[54]++;result.id=packet.id;cov_m2llyef2f().s[55]++;this.send(result);cov_m2llyef2f().s[56]++;break;}}}/*
 * Expose
 */cov_m2llyef2f().s[57]++;module.exports=Master;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hc3Rlci5qcyJdLCJuYW1lcyI6WyJhc3NlcnQiLCJyZXF1aXJlIiwiRXZlbnRFbWl0dGVyIiwiZm9ybWF0IiwiTmV0d29yayIsImpvYnMiLCJQYXJzZXIiLCJGcmFtZXIiLCJwYWNrZXRzIiwiUGFyZW50IiwiTWFzdGVyIiwiY29uc3RydWN0b3IiLCJwYXJlbnQiLCJmcmFtZXIiLCJwYXJzZXIiLCJsaXN0ZW5pbmciLCJjb2xvciIsImluaXQiLCJvbiIsImRhdGEiLCJmZWVkIiwiZXJyIiwiZW1pdCIsInNlbmQiLCJFcnJvclBhY2tldCIsInNldFRpbWVvdXQiLCJkZXN0cm95IiwicGFja2V0Iiwic2V0RW52IiwiZW52IiwiQkNPSU5fV09SS0VSX0lTVFRZIiwic2V0IiwiQkNPSU5fV09SS0VSX05FVFdPUksiLCJuZXR3b3JrIiwid3JpdGUiLCJzZW5kRXZlbnQiLCJpdGVtcyIsIkV2ZW50UGFja2V0IiwibG9nIiwidGV4dCIsImFwcGx5IiwiYXJndW1lbnRzIiwiTG9nUGFja2V0IiwibGlzdGVuIiwiaGFuZGxlUGFja2V0IiwiZSIsInJlc3VsdCIsImNtZCIsInR5cGVzIiwiRU5WIiwiRVZFTlQiLCJFUlJPUiIsImVycm9yIiwiZXhlY3V0ZSIsImlkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBRUEsYSxnNE9BUVk7eUZBTlosS0FBTUEsQ0FBQUEsTUFBTSx5QkFBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUMsQ0FBQUEsWUFBWSx5QkFBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBVixDQUFsQixDQUNBLEtBQU0sQ0FBQ0UsTUFBRCwwQkFBV0YsT0FBTyxDQUFDLE1BQUQsQ0FBbEIsQ0FBTixDQUNBLEtBQU1HLENBQUFBLE9BQU8seUJBQUdILE9BQU8sQ0FBQyxxQkFBRCxDQUFWLENBQWIsQ0FDQSxLQUFNSSxDQUFBQSxJQUFJLHlCQUFHSixPQUFPLENBQUMsUUFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNSyxDQUFBQSxNQUFNLHlCQUFHTCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNTSxDQUFBQSxNQUFNLHlCQUFHTixPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNTyxDQUFBQSxPQUFPLHlCQUFHUCxPQUFPLENBQUMsV0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNUSxDQUFBQSxNQUFNLHlCQUFHUixPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FFQSxLQUFNUyxDQUFBQSxNQUFOLFFBQXFCUixDQUFBQSxZQUFhLENBQ2hDO0FBQ0Y7QUFDQTtBQUNBLEtBRUVTLFdBQVcsRUFBRywrQ0FDWixRQURZLHdCQUdaLEtBQUtDLE1BQUwsQ0FBYyxHQUFJSCxDQUFBQSxNQUFKLEVBQWQsQ0FIWSx3QkFJWixLQUFLSSxNQUFMLENBQWMsR0FBSU4sQ0FBQUEsTUFBSixFQUFkLENBSlksd0JBS1osS0FBS08sTUFBTCxDQUFjLEdBQUlSLENBQUFBLE1BQUosRUFBZCxDQUxZLHdCQU1aLEtBQUtTLFNBQUwsQ0FBaUIsS0FBakIsQ0FOWSx3QkFPWixLQUFLQyxLQUFMLENBQWEsS0FBYixDQVBZLHdCQVNaLEtBQUtDLElBQUwsR0FDRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBLEtBRUVBLElBQUksRUFBRyxnREFDTCxLQUFLTCxNQUFMLENBQVlNLEVBQVosQ0FBZSxNQUFmLENBQXdCQyxJQUFELEVBQVUsZ0RBQy9CLEtBQUtMLE1BQUwsQ0FBWU0sSUFBWixDQUFpQkQsSUFBakIsRUFDRCxDQUZELEVBREssd0JBS0wsS0FBS1AsTUFBTCxDQUFZTSxFQUFaLENBQWUsT0FBZixDQUF5QkcsR0FBRCxFQUFTLGdEQUMvQixLQUFLQyxJQUFMLENBQVUsT0FBVixDQUFtQkQsR0FBbkIsRUFDRCxDQUZELEVBTEssd0JBU0wsS0FBS1QsTUFBTCxDQUFZTSxFQUFaLENBQWUsV0FBZixDQUE2QkcsR0FBRCxFQUFTLGdEQUNuQyxLQUFLRSxJQUFMLENBQVUsR0FBSWYsQ0FBQUEsT0FBTyxDQUFDZ0IsV0FBWixDQUF3QkgsR0FBeEIsQ0FBVixFQURtQyx3QkFFbkNJLFVBQVUsQ0FBQyxJQUFNLDREQUFLQyxPQUFMLEdBQWMsQ0FBckIsQ0FBdUIsSUFBdkIsQ0FBVixDQUNELENBSEQsRUFUSyx3QkFjTCxLQUFLWixNQUFMLENBQVlJLEVBQVosQ0FBZSxPQUFmLENBQXlCRyxHQUFELEVBQVMsZ0RBQy9CLEtBQUtDLElBQUwsQ0FBVSxPQUFWLENBQW1CRCxHQUFuQixFQUNELENBRkQsRUFkSyx3QkFrQkwsS0FBS1AsTUFBTCxDQUFZSSxFQUFaLENBQWUsUUFBZixDQUEwQlMsTUFBRCxFQUFZLGdEQUNuQyxLQUFLTCxJQUFMLENBQVUsUUFBVixDQUFvQkssTUFBcEIsRUFDRCxDQUZELEVBR0QsQ0FFRDtBQUNGO0FBQ0E7QUFDQSxLQUVFQyxNQUFNLENBQUNDLEdBQUQsQ0FBTSxnREFDVixLQUFLYixLQUFMLENBQWFhLEdBQUcsQ0FBQ0Msa0JBQUosR0FBMkIsR0FBeEMsQ0FEVSx3QkFFVixLQUFLQyxHQUFMLENBQVNGLEdBQUcsQ0FBQ0csb0JBQWIsRUFDRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBLEtBRUVELEdBQUcsQ0FBQ0UsT0FBRCxDQUFVLGdEQUNYLE1BQU83QixDQUFBQSxPQUFPLENBQUMyQixHQUFSLENBQVlFLE9BQVosQ0FBUCxDQUNELENBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQSxLQUVFQyxLQUFLLENBQUNmLElBQUQsQ0FBTyxpREFDVixNQUFPLE1BQUtQLE1BQUwsQ0FBWXNCLEtBQVosQ0FBa0JmLElBQWxCLENBQVAsQ0FDRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsS0FFRUksSUFBSSxDQUFDSSxNQUFELENBQVMsaURBQ1gsTUFBTyxNQUFLTyxLQUFMLENBQVcsS0FBS3JCLE1BQUwsQ0FBWWMsTUFBWixDQUFtQkEsTUFBbkIsQ0FBWCxDQUFQLENBQ0QsQ0FFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FFRVEsU0FBUyxDQUFDLEdBQUdDLEtBQUosQ0FBVyxpREFDbEIsTUFBTyxNQUFLYixJQUFMLENBQVUsR0FBSWYsQ0FBQUEsT0FBTyxDQUFDNkIsV0FBWixDQUF3QkQsS0FBeEIsQ0FBVixDQUFQLENBQ0QsQ0FFRDtBQUNGO0FBQ0EsS0FFRVYsT0FBTyxFQUFHLGlEQUNSLE1BQU8sTUFBS2QsTUFBTCxDQUFZYyxPQUFaLEVBQVAsQ0FDRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsS0FFRVksR0FBRyxFQUFHLHlCQUNKLEtBQU1DLENBQUFBLElBQUksMEJBQUdwQyxNQUFNLENBQUNxQyxLQUFQLENBQWEsSUFBYixDQUFtQkMsU0FBbkIsQ0FBSCxDQUFWLENBREksd0JBRUosS0FBS2xCLElBQUwsQ0FBVSxHQUFJZixDQUFBQSxPQUFPLENBQUNrQyxTQUFaLENBQXNCSCxJQUF0QixDQUFWLEVBQ0QsQ0FFRDtBQUNGO0FBQ0EsS0FFRUksTUFBTSxFQUFHLGlEQUNQM0MsTUFBTSxDQUFDLENBQUMsS0FBS2UsU0FBUCxDQUFrQixvQkFBbEIsQ0FBTixDQURPLHdCQUdQLEtBQUtBLFNBQUwsQ0FBaUIsSUFBakIsQ0FITyx3QkFLUCxLQUFLRyxFQUFMLENBQVEsT0FBUixDQUFrQkcsR0FBRCxFQUFTLGlEQUN4QixLQUFLRSxJQUFMLENBQVUsR0FBSWYsQ0FBQUEsT0FBTyxDQUFDZ0IsV0FBWixDQUF3QkgsR0FBeEIsQ0FBVixFQUNELENBRkQsRUFMTyx3QkFTUCxLQUFLSCxFQUFMLENBQVEsUUFBUixDQUFtQlMsTUFBRCxFQUFZLGlEQUM1QixHQUFJLHlCQUNGLEtBQUtpQixZQUFMLENBQWtCakIsTUFBbEIsRUFDRCxDQUFDLE1BQU9rQixDQUFQLENBQVUseUJBQ1YsS0FBS3ZCLElBQUwsQ0FBVSxPQUFWLENBQW1CdUIsQ0FBbkIsRUFDRCxDQUNGLENBTkQsRUFPRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsS0FFRUQsWUFBWSxDQUFDakIsTUFBRCxDQUFTLHlCQUNuQixHQUFJbUIsQ0FBQUEsTUFBSixDQURtQix3QkFHbkIsT0FBUW5CLE1BQU0sQ0FBQ29CLEdBQWYsRUFDRSxJQUFLdkMsQ0FBQUEsT0FBTyxDQUFDd0MsS0FBUixDQUFjQyxHQUFuQixtREFDRSxLQUFLckIsTUFBTCxDQUFZRCxNQUFNLENBQUNFLEdBQW5CLEVBREYsd0JBRUUsTUFDRixJQUFLckIsQ0FBQUEsT0FBTyxDQUFDd0MsS0FBUixDQUFjRSxLQUFuQixtREFDRSxLQUFLNUIsSUFBTCxDQUFVLE9BQVYsQ0FBbUJLLE1BQU0sQ0FBQ1MsS0FBMUIsRUFERix3QkFFRSxLQUFLZCxJQUFMLENBQVUsR0FBR0ssTUFBTSxDQUFDUyxLQUFwQixFQUZGLHdCQUdFLE1BQ0YsSUFBSzVCLENBQUFBLE9BQU8sQ0FBQ3dDLEtBQVIsQ0FBY0csS0FBbkIsbURBQ0UsS0FBSzdCLElBQUwsQ0FBVSxPQUFWLENBQW1CSyxNQUFNLENBQUN5QixLQUExQixFQURGLHdCQUVFLE1BQ0YsMERBQ0VOLE1BQU0sQ0FBR3pDLElBQUksQ0FBQ2dELE9BQUwsQ0FBYTFCLE1BQWIsQ0FBVCxDQURGLHdCQUVFbUIsTUFBTSxDQUFDUSxFQUFQLENBQVkzQixNQUFNLENBQUMyQixFQUFuQixDQUZGLHdCQUdFLEtBQUsvQixJQUFMLENBQVV1QixNQUFWLEVBSEYsd0JBSUUsTUFmSixDQWlCRCxDQW5LK0IsQ0FzS2xDO0FBQ0E7QUFDQSxHLHdCQUVBUyxNQUFNLENBQUNDLE9BQVAsQ0FBaUI5QyxNQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxyXG4gKiBtYXN0ZXIuanMgLSBtYXN0ZXIgcHJvY2VzcyBmb3IgYmNvaW5cclxuICogQ29weXJpZ2h0IChjKSAyMDE0LTIwMTUsIEZlZG9yIEluZHV0bnkgKE1JVCBMaWNlbnNlKVxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQtMjAxNywgQ2hyaXN0b3BoZXIgSmVmZnJleSAoTUlUIExpY2Vuc2UpLlxyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vYmNvaW4tb3JnL2Jjb2luXHJcbiAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZSgnYnNlcnQnKTtcclxuY29uc3QgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnZXZlbnRzJyk7XHJcbmNvbnN0IHtmb3JtYXR9ID0gcmVxdWlyZSgndXRpbCcpO1xyXG5jb25zdCBOZXR3b3JrID0gcmVxdWlyZSgnLi4vcHJvdG9jb2wvbmV0d29yaycpO1xyXG5jb25zdCBqb2JzID0gcmVxdWlyZSgnLi9qb2JzJyk7XHJcbmNvbnN0IFBhcnNlciA9IHJlcXVpcmUoJy4vcGFyc2VyJyk7XHJcbmNvbnN0IEZyYW1lciA9IHJlcXVpcmUoJy4vZnJhbWVyJyk7XHJcbmNvbnN0IHBhY2tldHMgPSByZXF1aXJlKCcuL3BhY2tldHMnKTtcclxuY29uc3QgUGFyZW50ID0gcmVxdWlyZSgnLi9wYXJlbnQnKTtcclxuXHJcbi8qKlxyXG4gKiBNYXN0ZXJcclxuICogUmVwcmVzZW50cyB0aGUgbWFzdGVyIHByb2Nlc3MuXHJcbiAqIEBhbGlhcyBtb2R1bGU6d29ya2Vycy5NYXN0ZXJcclxuICogQGV4dGVuZHMgRXZlbnRFbWl0dGVyXHJcbiAqL1xyXG5cclxuY2xhc3MgTWFzdGVyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuICAvKipcclxuICAgKiBDcmVhdGUgdGhlIG1hc3RlciBwcm9jZXNzLlxyXG4gICAqIEBjb25zdHJ1Y3RvclxyXG4gICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5wYXJlbnQgPSBuZXcgUGFyZW50KCk7XHJcbiAgICB0aGlzLmZyYW1lciA9IG5ldyBGcmFtZXIoKTtcclxuICAgIHRoaXMucGFyc2VyID0gbmV3IFBhcnNlcigpO1xyXG4gICAgdGhpcy5saXN0ZW5pbmcgPSBmYWxzZTtcclxuICAgIHRoaXMuY29sb3IgPSBmYWxzZTtcclxuXHJcbiAgICB0aGlzLmluaXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpemUgbWFzdGVyLiBCaW5kIGV2ZW50cy5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG5cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy5wYXJlbnQub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xyXG4gICAgICB0aGlzLnBhcnNlci5mZWVkKGRhdGEpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5wYXJlbnQub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICB0aGlzLmVtaXQoJ2Vycm9yJywgZXJyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMucGFyZW50Lm9uKCdleGNlcHRpb24nLCAoZXJyKSA9PiB7XHJcbiAgICAgIHRoaXMuc2VuZChuZXcgcGFja2V0cy5FcnJvclBhY2tldChlcnIpKTtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmRlc3Ryb3koKSwgMTAwMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnBhcnNlci5vbignZXJyb3InLCAoZXJyKSA9PiB7XHJcbiAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBlcnIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5wYXJzZXIub24oJ3BhY2tldCcsIChwYWNrZXQpID0+IHtcclxuICAgICAgdGhpcy5lbWl0KCdwYWNrZXQnLCBwYWNrZXQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXQgZW52aXJvbm1lbnQuXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGVudlxyXG4gICAqL1xyXG5cclxuICBzZXRFbnYoZW52KSB7XHJcbiAgICB0aGlzLmNvbG9yID0gZW52LkJDT0lOX1dPUktFUl9JU1RUWSA9PT0gJzEnO1xyXG4gICAgdGhpcy5zZXQoZW52LkJDT0lOX1dPUktFUl9ORVRXT1JLKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCBwcmltYXJ5IG5ldHdvcmsuXHJcbiAgICogQHBhcmFtIHtOZXR3b3JrVHlwZXxOZXR3b3JrfSBuZXR3b3JrXHJcbiAgICovXHJcblxyXG4gIHNldChuZXR3b3JrKSB7XHJcbiAgICByZXR1cm4gTmV0d29yay5zZXQobmV0d29yayk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZW5kIGRhdGEgdG8gd29ya2VyLlxyXG4gICAqIEBwYXJhbSB7QnVmZmVyfSBkYXRhXHJcbiAgICogQHJldHVybnMge0Jvb2xlYW59XHJcbiAgICovXHJcblxyXG4gIHdyaXRlKGRhdGEpIHtcclxuICAgIHJldHVybiB0aGlzLnBhcmVudC53cml0ZShkYXRhKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZyYW1lIGFuZCBzZW5kIGEgcGFja2V0LlxyXG4gICAqIEBwYXJhbSB7UGFja2V0fSBwYWNrZXRcclxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cclxuICAgKi9cclxuXHJcbiAgc2VuZChwYWNrZXQpIHtcclxuICAgIHJldHVybiB0aGlzLndyaXRlKHRoaXMuZnJhbWVyLnBhY2tldChwYWNrZXQpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVtaXQgYW4gZXZlbnQgb24gdGhlIHdvcmtlciBzaWRlLlxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudFxyXG4gICAqIEBwYXJhbSB7Li4uT2JqZWN0fSBhcmdcclxuICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cclxuICAgKi9cclxuXHJcbiAgc2VuZEV2ZW50KC4uLml0ZW1zKSB7XHJcbiAgICByZXR1cm4gdGhpcy5zZW5kKG5ldyBwYWNrZXRzLkV2ZW50UGFja2V0KGl0ZW1zKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEZXN0cm95IHRoZSB3b3JrZXIuXHJcbiAgICovXHJcblxyXG4gIGRlc3Ryb3koKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJlbnQuZGVzdHJveSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogV3JpdGUgYSBtZXNzYWdlIHRvIHN0ZG91dCBpbiB0aGUgbWFzdGVyIHByb2Nlc3MuXHJcbiAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSBvYmpcclxuICAgKiBAcGFyYW0gey4uLlN0cmluZ30gYXJnc1xyXG4gICAqL1xyXG5cclxuICBsb2coKSB7XHJcbiAgICBjb25zdCB0ZXh0ID0gZm9ybWF0LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XHJcbiAgICB0aGlzLnNlbmQobmV3IHBhY2tldHMuTG9nUGFja2V0KHRleHQpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExpc3RlbiBmb3IgbWVzc2FnZXMgZnJvbSBtYXN0ZXIgcHJvY2VzcyAob25seSBpZiB3b3JrZXIpLlxyXG4gICAqL1xyXG5cclxuICBsaXN0ZW4oKSB7XHJcbiAgICBhc3NlcnQoIXRoaXMubGlzdGVuaW5nLCAnQWxyZWFkeSBsaXN0ZW5pbmcuJyk7XHJcblxyXG4gICAgdGhpcy5saXN0ZW5pbmcgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICB0aGlzLnNlbmQobmV3IHBhY2tldHMuRXJyb3JQYWNrZXQoZXJyKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLm9uKCdwYWNrZXQnLCAocGFja2V0KSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVQYWNrZXQocGFja2V0KTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBIYW5kbGUgcGFja2V0LlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHBhcmFtIHtQYWNrZXR9XHJcbiAgICovXHJcblxyXG4gIGhhbmRsZVBhY2tldChwYWNrZXQpIHtcclxuICAgIGxldCByZXN1bHQ7XHJcblxyXG4gICAgc3dpdGNoIChwYWNrZXQuY21kKSB7XHJcbiAgICAgIGNhc2UgcGFja2V0cy50eXBlcy5FTlY6XHJcbiAgICAgICAgdGhpcy5zZXRFbnYocGFja2V0LmVudik7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgcGFja2V0cy50eXBlcy5FVkVOVDpcclxuICAgICAgICB0aGlzLmVtaXQoJ2V2ZW50JywgcGFja2V0Lml0ZW1zKTtcclxuICAgICAgICB0aGlzLmVtaXQoLi4ucGFja2V0Lml0ZW1zKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBwYWNrZXRzLnR5cGVzLkVSUk9SOlxyXG4gICAgICAgIHRoaXMuZW1pdCgnZXJyb3InLCBwYWNrZXQuZXJyb3IpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJlc3VsdCA9IGpvYnMuZXhlY3V0ZShwYWNrZXQpO1xyXG4gICAgICAgIHJlc3VsdC5pZCA9IHBhY2tldC5pZDtcclxuICAgICAgICB0aGlzLnNlbmQocmVzdWx0KTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8qXHJcbiAqIEV4cG9zZVxyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gTWFzdGVyO1xyXG4iXX0=