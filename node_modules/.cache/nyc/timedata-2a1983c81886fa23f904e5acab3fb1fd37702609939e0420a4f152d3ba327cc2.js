/*!
 * timedata.js - time management for bcoin
 * Copyright (c) 2014-2015, Fedor Indutny (MIT License)
 * Copyright (c) 2014-2017, Christopher Jeffrey (MIT License).
 * https://github.com/bcoin-org/bcoin
 */'use strict';function cov_2lizn0wn9u(){var path="E:\\Projects\\Test\\bcoin\\lib\\protocol\\timedata.js";var hash="27b2f0ca75c28e0d9e6fa85fd5437aea5ce5d0f5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\Projects\\Test\\bcoin\\lib\\protocol\\timedata.js",statementMap:{"0":{start:{line:10,column:21},end:{line:10,column:38}},"1":{start:{line:11,column:13},end:{line:11,column:37}},"2":{start:{line:12,column:15},end:{line:12,column:41}},"3":{start:{line:36,column:4},end:{line:36,column:12}},"4":{start:{line:38,column:4},end:{line:39,column:18}},"5":{start:{line:39,column:6},end:{line:39,column:18}},"6":{start:{line:41,column:4},end:{line:41,column:22}},"7":{start:{line:42,column:4},end:{line:42,column:27}},"8":{start:{line:43,column:4},end:{line:43,column:23}},"9":{start:{line:44,column:4},end:{line:44,column:20}},"10":{start:{line:45,column:4},end:{line:45,column:25}},"11":{start:{line:55,column:4},end:{line:56,column:13}},"12":{start:{line:56,column:6},end:{line:56,column:13}},"13":{start:{line:58,column:4},end:{line:59,column:13}},"14":{start:{line:59,column:6},end:{line:59,column:13}},"15":{start:{line:61,column:19},end:{line:61,column:36}},"16":{start:{line:63,column:4},end:{line:63,column:31}},"17":{start:{line:65,column:4},end:{line:65,column:49}},"18":{start:{line:67,column:4},end:{line:67,column:53}},"19":{start:{line:69,column:4},end:{line:94,column:5}},"20":{start:{line:70,column:19},end:{line:70,column:58}},"21":{start:{line:72,column:6},end:{line:90,column:7}},"22":{start:{line:73,column:8},end:{line:87,column:9}},"23":{start:{line:74,column:22},end:{line:74,column:27}},"24":{start:{line:76,column:10},end:{line:81,column:11}},"25":{start:{line:77,column:12},end:{line:80,column:13}},"26":{start:{line:78,column:14},end:{line:78,column:27}},"27":{start:{line:79,column:14},end:{line:79,column:20}},"28":{start:{line:83,column:10},end:{line:86,column:11}},"29":{start:{line:84,column:12},end:{line:84,column:32}},"30":{start:{line:85,column:12},end:{line:85,column:34}},"31":{start:{line:89,column:8},end:{line:89,column:19}},"32":{start:{line:92,column:6},end:{line:92,column:27}},"33":{start:{line:93,column:6},end:{line:93,column:39}},"34":{start:{line:103,column:4},end:{line:103,column:36}},"35":{start:{line:113,column:4},end:{line:113,column:30}},"36":{start:{line:123,column:4},end:{line:123,column:30}},"37":{start:{line:132,column:4},end:{line:132,column:43}},"38":{start:{line:141,column:2},end:{line:141,column:15}},"39":{start:{line:148,column:0},end:{line:148,column:26}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:35,column:2},end:{line:35,column:3}},loc:{start:{line:35,column:21},end:{line:46,column:3}},line:35},"1":{name:"(anonymous_1)",decl:{start:{line:54,column:2},end:{line:54,column:3}},loc:{start:{line:54,column:16},end:{line:95,column:3}},line:54},"2":{name:"(anonymous_2)",decl:{start:{line:102,column:2},end:{line:102,column:3}},loc:{start:{line:102,column:8},end:{line:104,column:3}},line:102},"3":{name:"(anonymous_3)",decl:{start:{line:112,column:2},end:{line:112,column:3}},loc:{start:{line:112,column:15},end:{line:114,column:3}},line:112},"4":{name:"(anonymous_4)",decl:{start:{line:122,column:2},end:{line:122,column:3}},loc:{start:{line:122,column:14},end:{line:124,column:3}},line:122},"5":{name:"(anonymous_5)",decl:{start:{line:131,column:2},end:{line:131,column:3}},loc:{start:{line:131,column:7},end:{line:133,column:3}},line:131},"6":{name:"compare",decl:{start:{line:140,column:9},end:{line:140,column:16}},loc:{start:{line:140,column:23},end:{line:142,column:1}},line:140}},branchMap:{"0":{loc:{start:{line:38,column:4},end:{line:39,column:18}},type:"if",locations:[{start:{line:38,column:4},end:{line:39,column:18}},{start:{line:38,column:4},end:{line:39,column:18}}],line:38},"1":{loc:{start:{line:55,column:4},end:{line:56,column:13}},type:"if",locations:[{start:{line:55,column:4},end:{line:56,column:13}},{start:{line:55,column:4},end:{line:56,column:13}}],line:55},"2":{loc:{start:{line:58,column:4},end:{line:59,column:13}},type:"if",locations:[{start:{line:58,column:4},end:{line:59,column:13}},{start:{line:58,column:4},end:{line:59,column:13}}],line:58},"3":{loc:{start:{line:69,column:4},end:{line:94,column:5}},type:"if",locations:[{start:{line:69,column:4},end:{line:94,column:5}},{start:{line:69,column:4},end:{line:94,column:5}}],line:69},"4":{loc:{start:{line:69,column:8},end:{line:69,column:65}},type:"binary-expr",locations:[{start:{line:69,column:8},end:{line:69,column:32}},{start:{line:69,column:36},end:{line:69,column:65}}],line:69},"5":{loc:{start:{line:72,column:6},end:{line:90,column:7}},type:"if",locations:[{start:{line:72,column:6},end:{line:90,column:7}},{start:{line:72,column:6},end:{line:90,column:7}}],line:72},"6":{loc:{start:{line:73,column:8},end:{line:87,column:9}},type:"if",locations:[{start:{line:73,column:8},end:{line:87,column:9}},{start:{line:73,column:8},end:{line:87,column:9}}],line:73},"7":{loc:{start:{line:77,column:12},end:{line:80,column:13}},type:"if",locations:[{start:{line:77,column:12},end:{line:80,column:13}},{start:{line:77,column:12},end:{line:80,column:13}}],line:77},"8":{loc:{start:{line:77,column:16},end:{line:77,column:57}},type:"binary-expr",locations:[{start:{line:77,column:16},end:{line:77,column:28}},{start:{line:77,column:32},end:{line:77,column:57}}],line:77},"9":{loc:{start:{line:83,column:10},end:{line:86,column:11}},type:"if",locations:[{start:{line:83,column:10},end:{line:86,column:11}},{start:{line:83,column:10},end:{line:86,column:11}}],line:83}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"27b2f0ca75c28e0d9e6fa85fd5437aea5ce5d0f5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2lizn0wn9u=function(){return actualCoverage;};}return actualCoverage;}cov_2lizn0wn9u();const EventEmitter=(cov_2lizn0wn9u().s[0]++,require('events'));const util=(cov_2lizn0wn9u().s[1]++,require('../utils/util'));const binary=(cov_2lizn0wn9u().s[2]++,require('../utils/binary'));/**
 * Time Data
 * An object which handles "adjusted time". This may not
 * look it, but this is actually a semi-consensus-critical
 * piece of code. It handles version packets from peers
 * and calculates what to offset our system clock's time by.
 * @alias module:protocol.TimeData
 * @extends EventEmitter
 * @property {Array} samples
 * @property {Object} known
 * @property {Number} limit
 * @property {Number} offset
 */class TimeData extends EventEmitter{/**
   * Create time data.
   * @constructor
   * @param {Number} [limit=200]
   */constructor(limit){cov_2lizn0wn9u().f[0]++;cov_2lizn0wn9u().s[3]++;super();cov_2lizn0wn9u().s[4]++;if(limit==null){cov_2lizn0wn9u().b[0][0]++;cov_2lizn0wn9u().s[5]++;limit=200;}else{cov_2lizn0wn9u().b[0][1]++;}cov_2lizn0wn9u().s[6]++;this.samples=[];cov_2lizn0wn9u().s[7]++;this.known=new Map();cov_2lizn0wn9u().s[8]++;this.limit=limit;cov_2lizn0wn9u().s[9]++;this.offset=0;cov_2lizn0wn9u().s[10]++;this.checked=false;}/**
   * Add time data.
   * @param {String} id
   * @param {Number} time
   */add(id,time){cov_2lizn0wn9u().f[1]++;cov_2lizn0wn9u().s[11]++;if(this.samples.length>=this.limit){cov_2lizn0wn9u().b[1][0]++;cov_2lizn0wn9u().s[12]++;return;}else{cov_2lizn0wn9u().b[1][1]++;}cov_2lizn0wn9u().s[13]++;if(this.known.has(id)){cov_2lizn0wn9u().b[2][0]++;cov_2lizn0wn9u().s[14]++;return;}else{cov_2lizn0wn9u().b[2][1]++;}const sample=(cov_2lizn0wn9u().s[15]++,time-util.now());cov_2lizn0wn9u().s[16]++;this.known.set(id,sample);cov_2lizn0wn9u().s[17]++;binary.insert(this.samples,sample,compare);cov_2lizn0wn9u().s[18]++;this.emit('sample',sample,this.samples.length);cov_2lizn0wn9u().s[19]++;if((cov_2lizn0wn9u().b[4][0]++,this.samples.length>=5)&&(cov_2lizn0wn9u().b[4][1]++,this.samples.length%2===1)){cov_2lizn0wn9u().b[3][0]++;let median=(cov_2lizn0wn9u().s[20]++,this.samples[this.samples.length>>>1]);cov_2lizn0wn9u().s[21]++;if(Math.abs(median)>=70*60){cov_2lizn0wn9u().b[5][0]++;cov_2lizn0wn9u().s[22]++;if(!this.checked){cov_2lizn0wn9u().b[6][0]++;let match=(cov_2lizn0wn9u().s[23]++,false);cov_2lizn0wn9u().s[24]++;for(const offset of this.samples){cov_2lizn0wn9u().s[25]++;if((cov_2lizn0wn9u().b[8][0]++,offset!==0)&&(cov_2lizn0wn9u().b[8][1]++,Math.abs(offset)<5*60)){cov_2lizn0wn9u().b[7][0]++;cov_2lizn0wn9u().s[26]++;match=true;cov_2lizn0wn9u().s[27]++;break;}else{cov_2lizn0wn9u().b[7][1]++;}}cov_2lizn0wn9u().s[28]++;if(!match){cov_2lizn0wn9u().b[9][0]++;cov_2lizn0wn9u().s[29]++;this.checked=true;cov_2lizn0wn9u().s[30]++;this.emit('mismatch');}else{cov_2lizn0wn9u().b[9][1]++;}}else{cov_2lizn0wn9u().b[6][1]++;}cov_2lizn0wn9u().s[31]++;median=0;}else{cov_2lizn0wn9u().b[5][1]++;}cov_2lizn0wn9u().s[32]++;this.offset=median;cov_2lizn0wn9u().s[33]++;this.emit('offset',this.offset);}else{cov_2lizn0wn9u().b[3][1]++;}}/**
   * Get the current adjusted time.
   * @returns {Number} Adjusted Time.
   */now(){cov_2lizn0wn9u().f[2]++;cov_2lizn0wn9u().s[34]++;return util.now()+this.offset;}/**
   * Adjust a timestamp.
   * @param {Number} time
   * @returns {Number} Adjusted Time.
   */adjust(time){cov_2lizn0wn9u().f[3]++;cov_2lizn0wn9u().s[35]++;return time+this.offset;}/**
   * Unadjust a timestamp.
   * @param {Number} time
   * @returns {Number} Local Time.
   */local(time){cov_2lizn0wn9u().f[4]++;cov_2lizn0wn9u().s[36]++;return time-this.offset;}/**
   * Get the current adjusted time in milliseconds.
   * @returns {Number} Adjusted Time.
   */ms(){cov_2lizn0wn9u().f[5]++;cov_2lizn0wn9u().s[37]++;return Date.now()+this.offset*1000;}}/*
 * Helpers
 */function compare(a,b){cov_2lizn0wn9u().f[6]++;cov_2lizn0wn9u().s[38]++;return a-b;}/*
 * Expose
 */cov_2lizn0wn9u().s[39]++;module.exports=TimeData;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRpbWVkYXRhLmpzIl0sIm5hbWVzIjpbIkV2ZW50RW1pdHRlciIsInJlcXVpcmUiLCJ1dGlsIiwiYmluYXJ5IiwiVGltZURhdGEiLCJjb25zdHJ1Y3RvciIsImxpbWl0Iiwic2FtcGxlcyIsImtub3duIiwiTWFwIiwib2Zmc2V0IiwiY2hlY2tlZCIsImFkZCIsImlkIiwidGltZSIsImxlbmd0aCIsImhhcyIsInNhbXBsZSIsIm5vdyIsInNldCIsImluc2VydCIsImNvbXBhcmUiLCJlbWl0IiwibWVkaWFuIiwiTWF0aCIsImFicyIsIm1hdGNoIiwiYWRqdXN0IiwibG9jYWwiLCJtcyIsIkRhdGUiLCJhIiwiYiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUVBLGEsa21NQVFZOzJGQU5aLEtBQU1BLENBQUFBLFlBQVksMEJBQUdDLE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBbEIsQ0FDQSxLQUFNQyxDQUFBQSxJQUFJLDBCQUFHRCxPQUFPLENBQUMsZUFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNRSxDQUFBQSxNQUFNLDBCQUFHRixPQUFPLENBQUMsaUJBQUQsQ0FBVixDQUFaLENBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FFQSxLQUFNRyxDQUFBQSxRQUFOLFFBQXVCSixDQUFBQSxZQUFhLENBQ2xDO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsS0FFRUssV0FBVyxDQUFDQyxLQUFELENBQVEsaURBQ2pCLFFBRGlCLHdCQUdqQixHQUFJQSxLQUFLLEVBQUksSUFBYixDQUNFLG9EQUFBQSxLQUFLLENBQUcsR0FBUixDQUFZLENBRGQsaUNBSGlCLHdCQU1qQixLQUFLQyxPQUFMLENBQWUsRUFBZixDQU5pQix3QkFPakIsS0FBS0MsS0FBTCxDQUFhLEdBQUlDLENBQUFBLEdBQUosRUFBYixDQVBpQix3QkFRakIsS0FBS0gsS0FBTCxD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LFFBQVNXLENBQUFBLE9BQVQsQ0FBaUJVLENBQWpCLENBQW9CQyxDQUFwQixDQUF1QixrREFDckIsTUFBT0QsQ0FBQUEsQ0FBQyxDQUFHQyxDQUFYLENBQ0QsQ0FFRDtBQUNBO0FBQ0EsRyx5QkFFQUMsTUFBTSxDQUFDQyxPQUFQLENBQWlCOUIsUUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcclxuICogdGltZWRhdGEuanMgLSB0aW1lIG1hbmFnZW1lbnQgZm9yIGJjb2luXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNC0yMDE1LCBGZWRvciBJbmR1dG55IChNSVQgTGljZW5zZSlcclxuICogQ29weXJpZ2h0IChjKSAyMDE0LTIwMTcsIENocmlzdG9waGVyIEplZmZyZXkgKE1JVCBMaWNlbnNlKS5cclxuICogaHR0cHM6Ly9naXRodWIuY29tL2Jjb2luLW9yZy9iY29pblxyXG4gKi9cclxuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbmNvbnN0IEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpO1xyXG5jb25zdCB1dGlsID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbCcpO1xyXG5jb25zdCBiaW5hcnkgPSByZXF1aXJlKCcuLi91dGlscy9iaW5hcnknKTtcclxuXHJcbi8qKlxyXG4gKiBUaW1lIERhdGFcclxuICogQW4gb2JqZWN0IHdoaWNoIGhhbmRsZXMgXCJhZGp1c3RlZCB0aW1lXCIuIFRoaXMgbWF5IG5vdFxyXG4gKiBsb29rIGl0LCBidXQgdGhpcyBpcyBhY3R1YWxseSBhIHNlbWktY29uc2Vuc3VzLWNyaXRpY2FsXHJcbiAqIHBpZWNlIG9mIGNvZGUuIEl0IGhhbmRsZXMgdmVyc2lvbiBwYWNrZXRzIGZyb20gcGVlcnNcclxuICogYW5kIGNhbGN1bGF0ZXMgd2hhdCB0byBvZmZzZXQgb3VyIHN5c3RlbSBjbG9jaydzIHRpbWUgYnkuXHJcbiAqIEBhbGlhcyBtb2R1bGU6cHJvdG9jb2wuVGltZURhdGFcclxuICogQGV4dGVuZHMgRXZlbnRFbWl0dGVyXHJcbiAqIEBwcm9wZXJ0eSB7QXJyYXl9IHNhbXBsZXNcclxuICogQHByb3BlcnR5IHtPYmplY3R9IGtub3duXHJcbiAqIEBwcm9wZXJ0eSB7TnVtYmVyfSBsaW1pdFxyXG4gKiBAcHJvcGVydHkge051bWJlcn0gb2Zmc2V0XHJcbiAqL1xyXG5cclxuY2xhc3MgVGltZURhdGEgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSB0aW1lIGRhdGEuXHJcbiAgICogQGNvbnN0cnVjdG9yXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtsaW1pdD0yMDBdXHJcbiAgICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKGxpbWl0KSB7XHJcbiAgICBzdXBlcigpO1xyXG5cclxuICAgIGlmIChsaW1pdCA9PSBudWxsKVxyXG4gICAgICBsaW1pdCA9IDIwMDtcclxuXHJcbiAgICB0aGlzLnNhbXBsZXMgPSBbXTtcclxuICAgIHRoaXMua25vd24gPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLmxpbWl0ID0gbGltaXQ7XHJcbiAgICB0aGlzLm9mZnNldCA9IDA7XHJcbiAgICB0aGlzLmNoZWNrZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCB0aW1lIGRhdGEuXHJcbiAgICogQHBhcmFtIHtTdHJpbmd9IGlkXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVcclxuICAgKi9cclxuXHJcbiAgYWRkKGlkLCB0aW1lKSB7XHJcbiAgICBpZiAodGhpcy5zYW1wbGVzLmxlbmd0aCA+PSB0aGlzLmxpbWl0KVxyXG4gICAgICByZXR1cm47XHJcblxyXG4gICAgaWYgKHRoaXMua25vd24uaGFzKGlkKSlcclxuICAgICAgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHNhbXBsZSA9IHRpbWUgLSB1dGlsLm5vdygpO1xyXG5cclxuICAgIHRoaXMua25vd24uc2V0KGlkLCBzYW1wbGUpO1xyXG5cclxuICAgIGJpbmFyeS5pbnNlcnQodGhpcy5zYW1wbGVzLCBzYW1wbGUsIGNvbXBhcmUpO1xyXG5cclxuICAgIHRoaXMuZW1pdCgnc2FtcGxlJywgc2FtcGxlLCB0aGlzLnNhbXBsZXMubGVuZ3RoKTtcclxuXHJcbiAgICBpZiAodGhpcy5zYW1wbGVzLmxlbmd0aCA+PSA1ICYmIHRoaXMuc2FtcGxlcy5sZW5ndGggJSAyID09PSAxKSB7XHJcbiAgICAgIGxldCBtZWRpYW4gPSB0aGlzLnNhbXBsZXNbdGhpcy5zYW1wbGVzLmxlbmd0aCA+Pj4gMV07XHJcblxyXG4gICAgICBpZiAoTWF0aC5hYnMobWVkaWFuKSA+PSA3MCAqIDYwKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNoZWNrZWQpIHtcclxuICAgICAgICAgIGxldCBtYXRjaCA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgIGZvciAoY29uc3Qgb2Zmc2V0IG9mIHRoaXMuc2FtcGxlcykge1xyXG4gICAgICAgICAgICBpZiAob2Zmc2V0ICE9PSAwICYmIE1hdGguYWJzKG9mZnNldCkgPCA1ICogNjApIHtcclxuICAgICAgICAgICAgICBtYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoIW1hdGNoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnbWlzbWF0Y2gnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1lZGlhbiA9IDA7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMub2Zmc2V0ID0gbWVkaWFuO1xyXG4gICAgICB0aGlzLmVtaXQoJ29mZnNldCcsIHRoaXMub2Zmc2V0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgY3VycmVudCBhZGp1c3RlZCB0aW1lLlxyXG4gICAqIEByZXR1cm5zIHtOdW1iZXJ9IEFkanVzdGVkIFRpbWUuXHJcbiAgICovXHJcblxyXG4gIG5vdygpIHtcclxuICAgIHJldHVybiB1dGlsLm5vdygpICsgdGhpcy5vZmZzZXQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGp1c3QgYSB0aW1lc3RhbXAuXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVcclxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBBZGp1c3RlZCBUaW1lLlxyXG4gICAqL1xyXG5cclxuICBhZGp1c3QodGltZSkge1xyXG4gICAgcmV0dXJuIHRpbWUgKyB0aGlzLm9mZnNldDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVuYWRqdXN0IGEgdGltZXN0YW1wLlxyXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lXHJcbiAgICogQHJldHVybnMge051bWJlcn0gTG9jYWwgVGltZS5cclxuICAgKi9cclxuXHJcbiAgbG9jYWwodGltZSkge1xyXG4gICAgcmV0dXJuIHRpbWUgLSB0aGlzLm9mZnNldDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0aGUgY3VycmVudCBhZGp1c3RlZCB0aW1lIGluIG1pbGxpc2Vjb25kcy5cclxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBBZGp1c3RlZCBUaW1lLlxyXG4gICAqL1xyXG5cclxuICBtcygpIHtcclxuICAgIHJldHVybiBEYXRlLm5vdygpICsgdGhpcy5vZmZzZXQgKiAxMDAwO1xyXG4gIH1cclxufVxyXG5cclxuLypcclxuICogSGVscGVyc1xyXG4gKi9cclxuXHJcbmZ1bmN0aW9uIGNvbXBhcmUoYSwgYikge1xyXG4gIHJldHVybiBhIC0gYjtcclxufVxyXG5cclxuLypcclxuICogRXhwb3NlXHJcbiAqL1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBUaW1lRGF0YTtcclxuIl19