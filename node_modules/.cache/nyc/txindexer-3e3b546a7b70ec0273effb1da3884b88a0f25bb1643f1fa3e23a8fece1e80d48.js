/*!
 * txindexer.js - transaction indexer for bcoin
 * Copyright (c) 2018, the bcoin developers (MIT License).
 * https://github.com/bcoin-org/bcoin
 */'use strict';function cov_1egc0lusf7(){var path="E:\\Projects\\Test\\bcoin\\lib\\indexer\\txindexer.js";var hash="7ff7b5432f7f00220537b57bf0abd956c3ec1311";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\Projects\\Test\\bcoin\\lib\\indexer\\txindexer.js",statementMap:{"0":{start:{line:9,column:15},end:{line:9,column:31}},"1":{start:{line:10,column:12},end:{line:10,column:26}},"2":{start:{line:11,column:12},end:{line:11,column:28}},"3":{start:{line:12,column:15},end:{line:12,column:34}},"4":{start:{line:13,column:18},end:{line:13,column:50}},"5":{start:{line:14,column:11},end:{line:14,column:38}},"6":{start:{line:15,column:15},end:{line:15,column:46}},"7":{start:{line:16,column:16},end:{line:16,column:36}},"8":{start:{line:30,column:0},end:{line:33,column:3}},"9":{start:{line:46,column:4},end:{line:46,column:54}},"10":{start:{line:47,column:4},end:{line:47,column:34}},"11":{start:{line:49,column:4},end:{line:49,column:37}},"12":{start:{line:50,column:4},end:{line:50,column:44}},"13":{start:{line:60,column:15},end:{line:60,column:29}},"14":{start:{line:62,column:4},end:{line:62,column:31}},"15":{start:{line:63,column:4},end:{line:63,column:29}},"16":{start:{line:65,column:4},end:{line:65,column:16}},"17":{start:{line:76,column:4},end:{line:76,column:36}},"18":{start:{line:85,column:15},end:{line:85,column:28}},"19":{start:{line:87,column:4},end:{line:87,column:29}},"20":{start:{line:88,column:4},end:{line:88,column:27}},"21":{start:{line:90,column:4},end:{line:90,column:23}},"22":{start:{line:105,column:4},end:{line:105,column:38}},"23":{start:{line:106,column:4},end:{line:106,column:36}},"24":{start:{line:107,column:4},end:{line:107,column:38}},"25":{start:{line:108,column:4},end:{line:108,column:38}},"26":{start:{line:110,column:4},end:{line:110,column:48}},"27":{start:{line:111,column:4},end:{line:111,column:46}},"28":{start:{line:112,column:4},end:{line:112,column:48}},"29":{start:{line:113,column:4},end:{line:113,column:48}},"30":{start:{line:123,column:15},end:{line:123,column:29}},"31":{start:{line:125,column:4},end:{line:125,column:31}},"32":{start:{line:126,column:4},end:{line:126,column:30}},"33":{start:{line:127,column:4},end:{line:127,column:31}},"34":{start:{line:128,column:4},end:{line:128,column:31}},"35":{start:{line:130,column:4},end:{line:130,column:16}},"36":{start:{line:141,column:4},end:{line:141,column:36}},"37":{start:{line:150,column:15},end:{line:150,column:28}},"38":{start:{line:152,column:4},end:{line:152,column:29}},"39":{start:{line:153,column:4},end:{line:153,column:28}},"40":{start:{line:154,column:4},end:{line:154,column:29}},"41":{start:{line:155,column:4},end:{line:155,column:29}},"42":{start:{line:157,column:4},end:{line:157,column:23}},"43":{start:{line:175,column:4},end:{line:175,column:25}},"44":{start:{line:177,column:4},end:{line:177,column:39}},"45":{start:{line:189,column:4},end:{line:189,column:59}},"46":{start:{line:190,column:20},end:{line:193,column:6}},"47":{start:{line:195,column:4},end:{line:195,column:60}},"48":{start:{line:197,column:4},end:{line:211,column:5}},"49":{start:{line:197,column:17},end:{line:197,column:18}},"50":{start:{line:198,column:17},end:{line:198,column:29}},"51":{start:{line:200,column:19},end:{line:200,column:28}},"52":{start:{line:201,column:29},end:{line:201,column:45}},"53":{start:{line:203,column:23},end:{line:208,column:8}},"54":{start:{line:210,column:6},end:{line:210,column:56}},"55":{start:{line:223,column:4},end:{line:223,column:43}},"56":{start:{line:225,column:4},end:{line:229,column:5}},"57":{start:{line:225,column:17},end:{line:225,column:18}},"58":{start:{line:226,column:17},end:{line:226,column:29}},"59":{start:{line:227,column:19},end:{line:227,column:28}},"60":{start:{line:228,column:6},end:{line:228,column:38}},"61":{start:{line:239,column:16},end:{line:239,column:56}},"62":{start:{line:240,column:4},end:{line:241,column:18}},"63":{start:{line:241,column:6},end:{line:241,column:18}},"64":{start:{line:243,column:19},end:{line:243,column:40}},"65":{start:{line:244,column:44},end:{line:244,column:50}},"66":{start:{line:246,column:17},end:{line:246,column:59}},"67":{start:{line:247,column:4},end:{line:248,column:18}},"68":{start:{line:248,column:6},end:{line:248,column:18}},"69":{start:{line:250,column:20},end:{line:250,column:45}},"70":{start:{line:251,column:26},end:{line:251,column:33}},"71":{start:{line:253,column:17},end:{line:253,column:62}},"72":{start:{line:255,column:15},end:{line:255,column:31}},"73":{start:{line:257,column:17},end:{line:257,column:34}},"74":{start:{line:258,column:4},end:{line:258,column:25}},"75":{start:{line:259,column:4},end:{line:259,column:23}},"76":{start:{line:260,column:4},end:{line:260,column:21}},"77":{start:{line:261,column:4},end:{line:261,column:23}},"78":{start:{line:263,column:4},end:{line:263,column:16}},"79":{start:{line:273,column:17},end:{line:273,column:41}},"80":{start:{line:275,column:4},end:{line:276,column:18}},"81":{start:{line:276,column:6},end:{line:276,column:18}},"82":{start:{line:278,column:4},end:{line:278,column:19}},"83":{start:{line:287,column:4},end:{line:287,column:46}},"84":{start:{line:297,column:17},end:{line:297,column:49}},"85":{start:{line:299,column:4},end:{line:313,column:5}},"86":{start:{line:300,column:6},end:{line:301,column:17}},"87":{start:{line:301,column:8},end:{line:301,column:17}},"88":{start:{line:303,column:28},end:{line:303,column:35}},"89":{start:{line:304,column:19},end:{line:304,column:43}},"90":{start:{line:306,column:6},end:{line:307,column:17}},"91":{start:{line:307,column:8},end:{line:307,column:17}},"92":{start:{line:309,column:27},end:{line:309,column:31}},"93":{start:{line:311,column:6},end:{line:312,column:41}},"94":{start:{line:312,column:8},end:{line:312,column:41}},"95":{start:{line:315,column:4},end:{line:315,column:16}},"96":{start:{line:319,column:0},end:{line:319,column:27}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:45,column:2},end:{line:45,column:3}},loc:{start:{line:45,column:28},end:{line:51,column:3}},line:45},"1":{name:"(anonymous_1)",decl:{start:{line:59,column:2},end:{line:59,column:3}},loc:{start:{line:59,column:16},end:{line:66,column:3}},line:59},"2":{name:"(anonymous_2)",decl:{start:{line:75,column:2},end:{line:75,column:3}},loc:{start:{line:75,column:23},end:{line:77,column:3}},line:75},"3":{name:"(anonymous_3)",decl:{start:{line:84,column:2},end:{line:84,column:3}},loc:{start:{line:84,column:10},end:{line:91,column:3}},line:84},"4":{name:"(anonymous_4)",decl:{start:{line:104,column:2},end:{line:104,column:3}},loc:{start:{line:104,column:28},end:{line:114,column:3}},line:104},"5":{name:"(anonymous_5)",decl:{start:{line:122,column:2},end:{line:122,column:3}},loc:{start:{line:122,column:16},end:{line:131,column:3}},line:122},"6":{name:"(anonymous_6)",decl:{start:{line:140,column:2},end:{line:140,column:3}},loc:{start:{line:140,column:23},end:{line:142,column:3}},line:140},"7":{name:"(anonymous_7)",decl:{start:{line:149,column:2},end:{line:149,column:3}},loc:{start:{line:149,column:10},end:{line:158,column:3}},line:149},"8":{name:"(anonymous_8)",decl:{start:{line:174,column:2},end:{line:174,column:3}},loc:{start:{line:174,column:23},end:{line:178,column:3}},line:174},"9":{name:"(anonymous_9)",decl:{start:{line:188,column:2},end:{line:188,column:3}},loc:{start:{line:188,column:38},end:{line:212,column:3}},line:188},"10":{name:"(anonymous_10)",decl:{start:{line:222,column:2},end:{line:222,column:3}},loc:{start:{line:222,column:40},end:{line:230,column:3}},line:222},"11":{name:"(anonymous_11)",decl:{start:{line:238,column:2},end:{line:238,column:3}},loc:{start:{line:238,column:22},end:{line:264,column:3}},line:238},"12":{name:"(anonymous_12)",decl:{start:{line:272,column:2},end:{line:272,column:3}},loc:{start:{line:272,column:20},end:{line:279,column:3}},line:272},"13":{name:"(anonymous_13)",decl:{start:{line:286,column:2},end:{line:286,column:3}},loc:{start:{line:286,column:20},end:{line:288,column:3}},line:286},"14":{name:"(anonymous_14)",decl:{start:{line:296,column:2},end:{line:296,column:3}},loc:{start:{line:296,column:25},end:{line:316,column:3}},line:296}},branchMap:{"0":{loc:{start:{line:45,column:14},end:{line:45,column:26}},type:"default-arg",locations:[{start:{line:45,column:24},end:{line:45,column:26}}],line:45},"1":{loc:{start:{line:46,column:17},end:{line:46,column:53}},type:"binary-expr",locations:[{start:{line:46,column:17},end:{line:46,column:30}},{start:{line:46,column:34},end:{line:46,column:53}}],line:46},"2":{loc:{start:{line:47,column:16},end:{line:47,column:33}},type:"binary-expr",locations:[{start:{line:47,column:16},end:{line:47,column:28}},{start:{line:47,column:32},end:{line:47,column:33}}],line:47},"3":{loc:{start:{line:104,column:14},end:{line:104,column:26}},type:"default-arg",locations:[{start:{line:104,column:24},end:{line:104,column:26}}],line:104},"4":{loc:{start:{line:105,column:18},end:{line:105,column:37}},type:"binary-expr",locations:[{start:{line:105,column:18},end:{line:105,column:32}},{start:{line:105,column:36},end:{line:105,column:37}}],line:105},"5":{loc:{start:{line:106,column:17},end:{line:106,column:35}},type:"binary-expr",locations:[{start:{line:106,column:17},end:{line:106,column:30}},{start:{line:106,column:34},end:{line:106,column:35}}],line:106},"6":{loc:{start:{line:107,column:18},end:{line:107,column:37}},type:"binary-expr",locations:[{start:{line:107,column:18},end:{line:107,column:32}},{start:{line:107,column:36},end:{line:107,column:37}}],line:107},"7":{loc:{start:{line:108,column:18},end:{line:108,column:37}},type:"binary-expr",locations:[{start:{line:108,column:18},end:{line:108,column:32}},{start:{line:108,column:36},end:{line:108,column:37}}],line:108},"8":{loc:{start:{line:240,column:4},end:{line:241,column:18}},type:"if",locations:[{start:{line:240,column:4},end:{line:241,column:18}},{start:{line:240,column:4},end:{line:241,column:18}}],line:240},"9":{loc:{start:{line:247,column:4},end:{line:248,column:18}},type:"if",locations:[{start:{line:247,column:4},end:{line:248,column:18}},{start:{line:247,column:4},end:{line:248,column:18}}],line:247},"10":{loc:{start:{line:275,column:4},end:{line:276,column:18}},type:"if",locations:[{start:{line:275,column:4},end:{line:276,column:18}},{start:{line:275,column:4},end:{line:276,column:18}}],line:275},"11":{loc:{start:{line:300,column:6},end:{line:301,column:17}},type:"if",locations:[{start:{line:300,column:6},end:{line:301,column:17}},{start:{line:300,column:6},end:{line:301,column:17}}],line:300},"12":{loc:{start:{line:306,column:6},end:{line:307,column:17}},type:"if",locations:[{start:{line:306,column:6},end:{line:307,column:17}},{start:{line:306,column:6},end:{line:307,column:17}}],line:306},"13":{loc:{start:{line:311,column:6},end:{line:312,column:41}},type:"if",locations:[{start:{line:311,column:6},end:{line:312,column:41}},{start:{line:311,column:6},end:{line:312,column:41}}],line:311}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{"0":[0],"1":[0,0],"2":[0,0],"3":[0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7ff7b5432f7f00220537b57bf0abd956c3ec1311"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1egc0lusf7=function(){return actualCoverage;};}return actualCoverage;}cov_1egc0lusf7();const assert=(cov_1egc0lusf7().s[0]++,require('bsert'));const bdb=(cov_1egc0lusf7().s[1]++,require('bdb'));const bio=(cov_1egc0lusf7().s[2]++,require('bufio'));const layout=(cov_1egc0lusf7().s[3]++,require('./layout'));const consensus=(cov_1egc0lusf7().s[4]++,require('../protocol/consensus'));const TX=(cov_1egc0lusf7().s[5]++,require('../primitives/tx'));const TXMeta=(cov_1egc0lusf7().s[6]++,require('../primitives/txmeta'));const Indexer=(cov_1egc0lusf7().s[7]++,require('./indexer'));/*
 * TXIndexer Database Layout:
 *  t[hash] -> tx record
 *  b[height] -> block record
 *
 * The transaction index maps a transaction to a block
 * and an index, offset, and length within that block. The
 * block hash is stored in a separate record by height so that
 * the 32 byte hash is not repeated for every transaction
 * within a block.
 */cov_1egc0lusf7().s[8]++;Object.assign(layout,{t:bdb.key('t',['hash256']),b:bdb.key('b',['uint32'])});/**
 * Block Record
 */class BlockRecord{/**
   * Create a block record.
   * @constructor
   */constructor(options=(cov_1egc0lusf7().b[0][0]++,{})){cov_1egc0lusf7().f[0]++;cov_1egc0lusf7().s[9]++;this.block=(cov_1egc0lusf7().b[1][0]++,options.block)||(cov_1egc0lusf7().b[1][1]++,consensus.ZERO_HASH);cov_1egc0lusf7().s[10]++;this.time=(cov_1egc0lusf7().b[2][0]++,options.time)||(cov_1egc0lusf7().b[2][1]++,0);cov_1egc0lusf7().s[11]++;assert(this.block.length===32);cov_1egc0lusf7().s[12]++;assert(this.time>>>0===this.time);}/**
   * Inject properties from serialized data.
   * @private
   * @param {Buffer} data
   */fromRaw(data){cov_1egc0lusf7().f[1]++;const br=(cov_1egc0lusf7().s[13]++,bio.read(data));cov_1egc0lusf7().s[14]++;this.block=br.readHash();cov_1egc0lusf7().s[15]++;this.time=br.readU32();cov_1egc0lusf7().s[16]++;return this;}/**
   * Instantiate block record from serialized data.
   * @param {Hash} hash
   * @param {Buffer} data
   * @returns {BlockRecord}
   */static fromRaw(data){cov_1egc0lusf7().f[2]++;cov_1egc0lusf7().s[17]++;return new this().fromRaw(data);}/**
   * Serialize the block record.
   * @returns {Buffer}
   */toRaw(){cov_1egc0lusf7().f[3]++;const bw=(cov_1egc0lusf7().s[18]++,bio.write(36));cov_1egc0lusf7().s[19]++;bw.writeHash(this.block);cov_1egc0lusf7().s[20]++;bw.writeU32(this.time);cov_1egc0lusf7().s[21]++;return bw.render();}}/**
 * Transaction Record
 */class TxRecord{/**
   * Create a transaction record.
   * @constructor
   */constructor(options=(cov_1egc0lusf7().b[3][0]++,{})){cov_1egc0lusf7().f[4]++;cov_1egc0lusf7().s[22]++;this.height=(cov_1egc0lusf7().b[4][0]++,options.height)||(cov_1egc0lusf7().b[4][1]++,0);cov_1egc0lusf7().s[23]++;this.index=(cov_1egc0lusf7().b[5][0]++,options.index)||(cov_1egc0lusf7().b[5][1]++,0);cov_1egc0lusf7().s[24]++;this.offset=(cov_1egc0lusf7().b[6][0]++,options.offset)||(cov_1egc0lusf7().b[6][1]++,0);cov_1egc0lusf7().s[25]++;this.length=(cov_1egc0lusf7().b[7][0]++,options.length)||(cov_1egc0lusf7().b[7][1]++,0);cov_1egc0lusf7().s[26]++;assert(this.height>>>0===this.height);cov_1egc0lusf7().s[27]++;assert(this.index>>>0===this.index);cov_1egc0lusf7().s[28]++;assert(this.offset>>>0===this.offset);cov_1egc0lusf7().s[29]++;assert(this.length>>>0===this.length);}/**
   * Inject properties from serialized data.
   * @private
   * @param {Buffer} data
   */fromRaw(data){cov_1egc0lusf7().f[5]++;const br=(cov_1egc0lusf7().s[30]++,bio.read(data));cov_1egc0lusf7().s[31]++;this.height=br.readU32();cov_1egc0lusf7().s[32]++;this.index=br.readU32();cov_1egc0lusf7().s[33]++;this.offset=br.readU32();cov_1egc0lusf7().s[34]++;this.length=br.readU32();cov_1egc0lusf7().s[35]++;return this;}/**
   * Instantiate transaction record from serialized data.
   * @param {Hash} hash
   * @param {Buffer} data
   * @returns {BlockRecord}
   */static fromRaw(data){cov_1egc0lusf7().f[6]++;cov_1egc0lusf7().s[36]++;return new this().fromRaw(data);}/**
   * Serialize the transaction record.
   * @returns {Buffer}
   */toRaw(){cov_1egc0lusf7().f[7]++;const bw=(cov_1egc0lusf7().s[37]++,bio.write(16));cov_1egc0lusf7().s[38]++;bw.writeU32(this.height);cov_1egc0lusf7().s[39]++;bw.writeU32(this.index);cov_1egc0lusf7().s[40]++;bw.writeU32(this.offset);cov_1egc0lusf7().s[41]++;bw.writeU32(this.length);cov_1egc0lusf7().s[42]++;return bw.render();}}/**
 * TXIndexer
 * @alias module:indexer.TXIndexer
 * @extends Indexer
 */class TXIndexer extends Indexer{/**
   * Create a indexer
   * @constructor
   * @param {Object} options
   */constructor(options){cov_1egc0lusf7().f[8]++;cov_1egc0lusf7().s[43]++;super('tx',options);cov_1egc0lusf7().s[44]++;this.db=bdb.create(this.options);}/**
   * Index transactions by txid.
   * @private
   * @param {BlockMeta} meta
   * @param {Block} block
   * @param {CoinView} view
   */async indexBlock(meta,block,view){cov_1egc0lusf7().f[9]++;cov_1egc0lusf7().s[45]++;assert(block.hasRaw(),'Expected raw data for block.');const brecord=(cov_1egc0lusf7().s[46]++,new BlockRecord({block:meta.hash,time:block.time}));cov_1egc0lusf7().s[47]++;this.put(layout.b.encode(meta.height),brecord.toRaw());cov_1egc0lusf7().s[48]++;for(let i=(cov_1egc0lusf7().s[49]++,0);i<block.txs.length;i++){const tx=(cov_1egc0lusf7().s[50]++,block.txs[i]);const hash=(cov_1egc0lusf7().s[51]++,tx.hash());const{offset,size}=(cov_1egc0lusf7().s[52]++,tx.getPosition());const txrecord=(cov_1egc0lusf7().s[53]++,new TxRecord({height:meta.height,index:i,offset:offset,length:size}));cov_1egc0lusf7().s[54]++;this.put(layout.t.encode(hash),txrecord.toRaw());}}/**
   * Remove transactions from index.
   * @private
   * @param {BlockMeta} meta
   * @param {Block} block
   * @param {CoinView} view
   */async unindexBlock(meta,block,view){cov_1egc0lusf7().f[10]++;cov_1egc0lusf7().s[55]++;this.del(layout.b.encode(meta.height));cov_1egc0lusf7().s[56]++;for(let i=(cov_1egc0lusf7().s[57]++,0);i<block.txs.length;i++){const tx=(cov_1egc0lusf7().s[58]++,block.txs[i]);const hash=(cov_1egc0lusf7().s[59]++,tx.hash());cov_1egc0lusf7().s[60]++;this.del(layout.t.encode(hash));}}/**
   * Get a transaction with metadata.
   * @param {Hash} hash
   * @returns {Promise} - Returns {@link TXMeta}.
   */async getMeta(hash){cov_1egc0lusf7().f[11]++;const raw=(cov_1egc0lusf7().s[61]++,await this.db.get(layout.t.encode(hash)));cov_1egc0lusf7().s[62]++;if(!raw){cov_1egc0lusf7().b[8][0]++;cov_1egc0lusf7().s[63]++;return null;}else{cov_1egc0lusf7().b[8][1]++;}const record=(cov_1egc0lusf7().s[64]++,TxRecord.fromRaw(raw));const{height,index,offset,length}=(cov_1egc0lusf7().s[65]++,record);const braw=(cov_1egc0lusf7().s[66]++,await this.db.get(layout.b.encode(height)));cov_1egc0lusf7().s[67]++;if(!braw){cov_1egc0lusf7().b[9][0]++;cov_1egc0lusf7().s[68]++;return null;}else{cov_1egc0lusf7().b[9][1]++;}const brecord=(cov_1egc0lusf7().s[69]++,BlockRecord.fromRaw(braw));const{block,time}=(cov_1egc0lusf7().s[70]++,brecord);const data=(cov_1egc0lusf7().s[71]++,await this.blocks.read(block,offset,length));const tx=(cov_1egc0lusf7().s[72]++,TX.fromRaw(data));const meta=(cov_1egc0lusf7().s[73]++,TXMeta.fromTX(tx));cov_1egc0lusf7().s[74]++;meta.height=height;cov_1egc0lusf7().s[75]++;meta.block=block;cov_1egc0lusf7().s[76]++;meta.time=time;cov_1egc0lusf7().s[77]++;meta.index=index;cov_1egc0lusf7().s[78]++;return meta;}/**
   * Retrieve a transaction.
   * @param {Hash} hash
   * @returns {Promise} - Returns {@link TX}.
   */async getTX(hash){cov_1egc0lusf7().f[12]++;const meta=(cov_1egc0lusf7().s[79]++,await this.getMeta(hash));cov_1egc0lusf7().s[80]++;if(!meta){cov_1egc0lusf7().b[10][0]++;cov_1egc0lusf7().s[81]++;return null;}else{cov_1egc0lusf7().b[10][1]++;}cov_1egc0lusf7().s[82]++;return meta.tx;}/**
   * @param {Hash} hash
   * @returns {Promise} - Returns Boolean.
   */async hasTX(hash){cov_1egc0lusf7().f[13]++;cov_1egc0lusf7().s[83]++;return this.db.has(layout.t.encode(hash));}/**
   * Get coin viewpoint (historical).
   * @param {TX} tx
   * @returns {Promise} - Returns {@link CoinView}.
   */async getSpentView(tx){cov_1egc0lusf7().f[14]++;const view=(cov_1egc0lusf7().s[84]++,await this.chain.getCoinView(tx));cov_1egc0lusf7().s[85]++;for(const{prevout}of tx.inputs){cov_1egc0lusf7().s[86]++;if(view.hasEntry(prevout)){cov_1egc0lusf7().b[11][0]++;cov_1egc0lusf7().s[87]++;continue;}else{cov_1egc0lusf7().b[11][1]++;}const{hash,index}=(cov_1egc0lusf7().s[88]++,prevout);const meta=(cov_1egc0lusf7().s[89]++,await this.getMeta(hash));cov_1egc0lusf7().s[90]++;if(!meta){cov_1egc0lusf7().b[12][0]++;cov_1egc0lusf7().s[91]++;continue;}else{cov_1egc0lusf7().b[12][1]++;}const{tx,height}=(cov_1egc0lusf7().s[92]++,meta);cov_1egc0lusf7().s[93]++;if(index<tx.outputs.length){cov_1egc0lusf7().b[13][0]++;cov_1egc0lusf7().s[94]++;view.addIndex(tx,index,height);}else{cov_1egc0lusf7().b[13][1]++;}}cov_1egc0lusf7().s[95]++;return view;}}cov_1egc0lusf7().s[96]++;module.exports=TXIndexer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR4aW5kZXhlci5qcyJdLCJuYW1lcyI6WyJhc3NlcnQiLCJyZXF1aXJlIiwiYmRiIiwiYmlvIiwibGF5b3V0IiwiY29uc2Vuc3VzIiwiVFgiLCJUWE1ldGEiLCJJbmRleGVyIiwiT2JqZWN0IiwiYXNzaWduIiwidCIsImtleSIsImIiLCJCbG9ja1JlY29yZCIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsImJsb2NrIiwiWkVST19IQVNIIiwidGltZSIsImxlbmd0aCIsImZyb21SYXciLCJkYXRhIiwiYnIiLCJyZWFkIiwicmVhZEhhc2giLCJyZWFkVTMyIiwidG9SYXciLCJidyIsIndyaXRlIiwid3JpdGVIYXNoIiwid3JpdGVVMzIiLCJyZW5kZXIiLCJUeFJlY29yZCIsImhlaWdodCIsImluZGV4Iiwib2Zmc2V0IiwiVFhJbmRleGVyIiwiZGIiLCJjcmVhdGUiLCJpbmRleEJsb2NrIiwibWV0YSIsInZpZXciLCJoYXNSYXciLCJicmVjb3JkIiwiaGFzaCIsInB1dCIsImVuY29kZSIsImkiLCJ0eHMiLCJ0eCIsInNpemUiLCJnZXRQb3NpdGlvbiIsInR4cmVjb3JkIiwidW5pbmRleEJsb2NrIiwiZGVsIiwiZ2V0TWV0YSIsInJhdyIsImdldCIsInJlY29yZCIsImJyYXciLCJibG9ja3MiLCJmcm9tVFgiLCJnZXRUWCIsImhhc1RYIiwiaGFzIiwiZ2V0U3BlbnRWaWV3IiwiY2hhaW4iLCJnZXRDb2luVmlldyIsInByZXZvdXQiLCJpbnB1dHMiLCJoYXNFbnRyeSIsIm91dHB1dHMiLCJhZGRJbmRleCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FFQSxhLGcxWEFTWTsyRkFQWixLQUFNQSxDQUFBQSxNQUFNLDBCQUFHQyxPQUFPLENBQUMsT0FBRCxDQUFWLENBQVosQ0FDQSxLQUFNQyxDQUFBQSxHQUFHLDBCQUFHRCxPQUFPLENBQUMsS0FBRCxDQUFWLENBQVQsQ0FDQSxLQUFNRSxDQUFBQSxHQUFH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UixDQUFZN0QsTUFBTSxDQUFDTyxDQUFQLENBQVNvQyxNQUFULENBQWdCRixJQUFoQixDQUFaLENBQVAsQ0FDRCxDQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsS0FFRSxLQUFNcUIsQ0FBQUEsWUFBTixDQUFtQmhCLEVBQW5CLENBQXVCLDBCQUNyQixLQUFNUixDQUFBQSxJQUFJLDJCQUFHLEtBQU0sTUFBS3lCLEtBQUwsQ0FBV0MsV0FBWCxDQUF1QmxCLEVBQXZCLENBQVQsQ0FBVixDQURxQix5QkFHckIsSUFBSyxLQUFNLENBQUNtQixPQUFELENBQVgsRUFBd0JuQixDQUFBQSxFQUFFLENBQUNvQixNQUEzQixDQUFtQywwQkFDakMsR0FBSTVCLElBQUksQ0FBQzZCLFFBQUwsQ0FBY0YsT0FBZCxDQUFKLENBQ0UsK0RBQVMsQ0FEWCxrQ0FHQSxLQUFNLENBQUN4QixJQUFELENBQU9WLEtBQVAsNEJBQWdCa0MsT0FBaEIsQ0FBTixDQUNBLEtBQU01QixDQUFBQSxJQUFJLDJCQUFHLEtBQU0sTUFBS2UsT0FBTCxDQUFhWCxJQUFiLENBQVQsQ0FBVixDQUxpQyx5QkFPakMsR0FBSSxDQUFDSixJQUFMLENBQ0UsK0RBQVMsQ0FEWCxrQ0FHQSxLQUFNLENBQUNTLEVBQUQsQ0FBS2hCLE1BQUwsNEJBQWVPLElBQWYsQ0FBTixDQVZpQyx5QkFZakMsR0FBSU4sS0FBSyxDQUFHZSxFQUFFLENBQUNzQixPQUFILENBQVdwRCxNQUF2QixDQUNFLHNEQUFBc0IsSUFBSSxDQUFDK0IsUUFBTCxDQUFjdkIsRUFBZCxDQUFrQmYsS0FBbEIsQ0FBeUJELE1BQXpCLEVBQWlDLENBRG5DLGtDQUVELENBakJvQix5QkFtQnJCLE1BQU9RLENBQUFBLElBQVAsQ0FDRCxDQXJKNkIsQyx5QkF3SmhDZ0MsTUFBTSxDQUFDQyxPQUFQLENBQWlCdEMsU0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcclxuICogdHhpbmRleGVyLmpzIC0gdHJhbnNhY3Rpb24gaW5kZXhlciBmb3IgYmNvaW5cclxuICogQ29weXJpZ2h0IChjKSAyMDE4LCB0aGUgYmNvaW4gZGV2ZWxvcGVycyAoTUlUIExpY2Vuc2UpLlxyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vYmNvaW4tb3JnL2Jjb2luXHJcbiAqL1xyXG5cclxuJ3VzZSBzdHJpY3QnO1xyXG5cclxuY29uc3QgYXNzZXJ0ID0gcmVxdWlyZSgnYnNlcnQnKTtcclxuY29uc3QgYmRiID0gcmVxdWlyZSgnYmRiJyk7XHJcbmNvbnN0IGJpbyA9IHJlcXVpcmUoJ2J1ZmlvJyk7XHJcbmNvbnN0IGxheW91dCA9IHJlcXVpcmUoJy4vbGF5b3V0Jyk7XHJcbmNvbnN0IGNvbnNlbnN1cyA9IHJlcXVpcmUoJy4uL3Byb3RvY29sL2NvbnNlbnN1cycpO1xyXG5jb25zdCBUWCA9IHJlcXVpcmUoJy4uL3ByaW1pdGl2ZXMvdHgnKTtcclxuY29uc3QgVFhNZXRhID0gcmVxdWlyZSgnLi4vcHJpbWl0aXZlcy90eG1ldGEnKTtcclxuY29uc3QgSW5kZXhlciA9IHJlcXVpcmUoJy4vaW5kZXhlcicpO1xyXG5cclxuLypcclxuICogVFhJbmRleGVyIERhdGFiYXNlIExheW91dDpcclxuICogIHRbaGFzaF0gLT4gdHggcmVjb3JkXHJcbiAqICBiW2hlaWdodF0gLT4gYmxvY2sgcmVjb3JkXHJcbiAqXHJcbiAqIFRoZSB0cmFuc2FjdGlvbiBpbmRleCBtYXBzIGEgdHJhbnNhY3Rpb24gdG8gYSBibG9ja1xyXG4gKiBhbmQgYW4gaW5kZXgsIG9mZnNldCwgYW5kIGxlbmd0aCB3aXRoaW4gdGhhdCBibG9jay4gVGhlXHJcbiAqIGJsb2NrIGhhc2ggaXMgc3RvcmVkIGluIGEgc2VwYXJhdGUgcmVjb3JkIGJ5IGhlaWdodCBzbyB0aGF0XHJcbiAqIHRoZSAzMiBieXRlIGhhc2ggaXMgbm90IHJlcGVhdGVkIGZvciBldmVyeSB0cmFuc2FjdGlvblxyXG4gKiB3aXRoaW4gYSBibG9jay5cclxuICovXHJcblxyXG5PYmplY3QuYXNzaWduKGxheW91dCwge1xyXG4gIHQ6IGJkYi5rZXkoJ3QnLCBbJ2hhc2gyNTYnXSksXHJcbiAgYjogYmRiLmtleSgnYicsIFsndWludDMyJ10pXHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEJsb2NrIFJlY29yZFxyXG4gKi9cclxuXHJcbmNsYXNzIEJsb2NrUmVjb3JkIHtcclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBibG9jayByZWNvcmQuXHJcbiAgICogQGNvbnN0cnVjdG9yXHJcbiAgICovXHJcblxyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xyXG4gICAgdGhpcy5ibG9jayA9IG9wdGlvbnMuYmxvY2sgfHwgY29uc2Vuc3VzLlpFUk9fSEFTSDtcclxuICAgIHRoaXMudGltZSA9IG9wdGlvbnMudGltZSB8fCAwO1xyXG5cclxuICAgIGFzc2VydCh0aGlzLmJsb2NrLmxlbmd0aCA9PT0gMzIpO1xyXG4gICAgYXNzZXJ0KCh0aGlzLnRpbWUgPj4+IDApID09PSB0aGlzLnRpbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5qZWN0IHByb3BlcnRpZXMgZnJvbSBzZXJpYWxpemVkIGRhdGEuXHJcbiAgICogQHByaXZhdGVcclxuICAgKiBAcGFyYW0ge0J1ZmZlcn0gZGF0YVxyXG4gICAqL1xyXG5cclxuICBmcm9tUmF3KGRhdGEpIHtcclxuICAgIGNvbnN0IGJyID0gYmlvLnJlYWQoZGF0YSk7XHJcblxyXG4gICAgdGhpcy5ibG9jayA9IGJyLnJlYWRIYXNoKCk7XHJcbiAgICB0aGlzLnRpbWUgPSBici5yZWFkVTMyKCk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbnN0YW50aWF0ZSBibG9jayByZWNvcmQgZnJvbSBzZXJpYWxpemVkIGRhdGEuXHJcbiAgICogQHBhcmFtIHtIYXNofSBoYXNoXHJcbiAgICogQHBhcmFtIHtCdWZmZXJ9IGRhdGFcclxuICAgKiBAcmV0dXJucyB7QmxvY2tSZWNvcmR9XHJcbiAgICovXHJcblxyXG4gIHN0YXRpYyBmcm9tUmF3KGRhdGEpIHtcclxuICAgIHJldHVybiBuZXcgdGhpcygpLmZyb21SYXcoZGF0YSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXJpYWxpemUgdGhlIGJsb2NrIHJlY29yZC5cclxuICAgKiBAcmV0dXJucyB7QnVmZmVyfVxyXG4gICAqL1xyXG5cclxuICB0b1JhdygpIHtcclxuICAgIGNvbnN0IGJ3ID0gYmlvLndyaXRlKDM2KTtcclxuXHJcbiAgICBidy53cml0ZUhhc2godGhpcy5ibG9jayk7XHJcbiAgICBidy53cml0ZVUzMih0aGlzLnRpbWUpO1xyXG5cclxuICAgIHJldHVybiBidy5yZW5kZXIoKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUcmFuc2FjdGlvbiBSZWNvcmRcclxuICovXHJcblxyXG5jbGFzcyBUeFJlY29yZCB7XHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgdHJhbnNhY3Rpb24gcmVjb3JkLlxyXG4gICAqIEBjb25zdHJ1Y3RvclxyXG4gICAqL1xyXG5cclxuICBjb25zdHJ1Y3RvcihvcHRpb25zID0ge30pIHtcclxuICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgMDtcclxuICAgIHRoaXMuaW5kZXggPSBvcHRpb25zLmluZGV4IHx8IDA7XHJcbiAgICB0aGlzLm9mZnNldCA9IG9wdGlvbnMub2Zmc2V0IHx8IDA7XHJcbiAgICB0aGlzLmxlbmd0aCA9IG9wdGlvbnMubGVuZ3RoIHx8IDA7XHJcblxyXG4gICAgYXNzZXJ0KCh0aGlzLmhlaWdodCA+Pj4gMCkgPT09IHRoaXMuaGVpZ2h0KTtcclxuICAgIGFzc2VydCgodGhpcy5pbmRleCA+Pj4gMCkgPT09IHRoaXMuaW5kZXgpO1xyXG4gICAgYXNzZXJ0KCh0aGlzLm9mZnNldCA+Pj4gMCkgPT09IHRoaXMub2Zmc2V0KTtcclxuICAgIGFzc2VydCgodGhpcy5sZW5ndGggPj4+IDApID09PSB0aGlzLmxlbmd0aCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbmplY3QgcHJvcGVydGllcyBmcm9tIHNlcmlhbGl6ZWQgZGF0YS5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBwYXJhbSB7QnVmZmVyfSBkYXRhXHJcbiAgICovXHJcblxyXG4gIGZyb21SYXcoZGF0YSkge1xyXG4gICAgY29uc3QgYnIgPSBiaW8ucmVhZChkYXRhKTtcclxuXHJcbiAgICB0aGlzLmhlaWdodCA9IGJyLnJlYWRVMzIoKTtcclxuICAgIHRoaXMuaW5kZXggPSBici5yZWFkVTMyKCk7XHJcbiAgICB0aGlzLm9mZnNldCA9IGJyLnJlYWRVMzIoKTtcclxuICAgIHRoaXMubGVuZ3RoID0gYnIucmVhZFUzMigpO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5zdGFudGlhdGUgdHJhbnNhY3Rpb24gcmVjb3JkIGZyb20gc2VyaWFsaXplZCBkYXRhLlxyXG4gICAqIEBwYXJhbSB7SGFzaH0gaGFzaFxyXG4gICAqIEBwYXJhbSB7QnVmZmVyfSBkYXRhXHJcbiAgICogQHJldHVybnMge0Jsb2NrUmVjb3JkfVxyXG4gICAqL1xyXG5cclxuICBzdGF0aWMgZnJvbVJhdyhkYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IHRoaXMoKS5mcm9tUmF3KGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VyaWFsaXplIHRoZSB0cmFuc2FjdGlvbiByZWNvcmQuXHJcbiAgICogQHJldHVybnMge0J1ZmZlcn1cclxuICAgKi9cclxuXHJcbiAgdG9SYXcoKSB7XHJcbiAgICBjb25zdCBidyA9IGJpby53cml0ZSgxNik7XHJcblxyXG4gICAgYncud3JpdGVVMzIodGhpcy5oZWlnaHQpO1xyXG4gICAgYncud3JpdGVVMzIodGhpcy5pbmRleCk7XHJcbiAgICBidy53cml0ZVUzMih0aGlzLm9mZnNldCk7XHJcbiAgICBidy53cml0ZVUzMih0aGlzLmxlbmd0aCk7XHJcblxyXG4gICAgcmV0dXJuIGJ3LnJlbmRlcigpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFRYSW5kZXhlclxyXG4gKiBAYWxpYXMgbW9kdWxlOmluZGV4ZXIuVFhJbmRleGVyXHJcbiAqIEBleHRlbmRzIEluZGV4ZXJcclxuICovXHJcblxyXG5jbGFzcyBUWEluZGV4ZXIgZXh0ZW5kcyBJbmRleGVyIHtcclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBpbmRleGVyXHJcbiAgICogQGNvbnN0cnVjdG9yXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcclxuICAgKi9cclxuXHJcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xyXG4gICAgc3VwZXIoJ3R4Jywgb3B0aW9ucyk7XHJcblxyXG4gICAgdGhpcy5kYiA9IGJkYi5jcmVhdGUodGhpcy5vcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluZGV4IHRyYW5zYWN0aW9ucyBieSB0eGlkLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHBhcmFtIHtCbG9ja01ldGF9IG1ldGFcclxuICAgKiBAcGFyYW0ge0Jsb2NrfSBibG9ja1xyXG4gICAqIEBwYXJhbSB7Q29pblZpZXd9IHZpZXdcclxuICAgKi9cclxuXHJcbiAgYXN5bmMgaW5kZXhCbG9jayhtZXRhLCBibG9jaywgdmlldykge1xyXG4gICAgYXNzZXJ0KGJsb2NrLmhhc1JhdygpLCAnRXhwZWN0ZWQgcmF3IGRhdGEgZm9yIGJsb2NrLicpO1xyXG4gICAgY29uc3QgYnJlY29yZCA9IG5ldyBCbG9ja1JlY29yZCh7XHJcbiAgICAgIGJsb2NrOiBtZXRhLmhhc2gsXHJcbiAgICAgIHRpbWU6IGJsb2NrLnRpbWVcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMucHV0KGxheW91dC5iLmVuY29kZShtZXRhLmhlaWdodCksIGJyZWNvcmQudG9SYXcoKSk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9jay50eHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgdHggPSBibG9jay50eHNbaV07XHJcblxyXG4gICAgICBjb25zdCBoYXNoID0gdHguaGFzaCgpO1xyXG4gICAgICBjb25zdCB7b2Zmc2V0LCBzaXplfSA9IHR4LmdldFBvc2l0aW9uKCk7XHJcblxyXG4gICAgICBjb25zdCB0eHJlY29yZCA9IG5ldyBUeFJlY29yZCh7XHJcbiAgICAgICAgaGVpZ2h0OiBtZXRhLmhlaWdodCxcclxuICAgICAgICBpbmRleDogaSxcclxuICAgICAgICBvZmZzZXQ6IG9mZnNldCxcclxuICAgICAgICBsZW5ndGg6IHNpemVcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLnB1dChsYXlvdXQudC5lbmNvZGUoaGFzaCksIHR4cmVjb3JkLnRvUmF3KCkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIHRyYW5zYWN0aW9ucyBmcm9tIGluZGV4LlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICogQHBhcmFtIHtCbG9ja01ldGF9IG1ldGFcclxuICAgKiBAcGFyYW0ge0Jsb2NrfSBibG9ja1xyXG4gICAqIEBwYXJhbSB7Q29pblZpZXd9IHZpZXdcclxuICAgKi9cclxuXHJcbiAgYXN5bmMgdW5pbmRleEJsb2NrKG1ldGEsIGJsb2NrLCB2aWV3KSB7XHJcbiAgICB0aGlzLmRlbChsYXlvdXQuYi5lbmNvZGUobWV0YS5oZWlnaHQpKTtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrLnR4cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCB0eCA9IGJsb2NrLnR4c1tpXTtcclxuICAgICAgY29uc3QgaGFzaCA9IHR4Lmhhc2goKTtcclxuICAgICAgdGhpcy5kZWwobGF5b3V0LnQuZW5jb2RlKGhhc2gpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhIHRyYW5zYWN0aW9uIHdpdGggbWV0YWRhdGEuXHJcbiAgICogQHBhcmFtIHtIYXNofSBoYXNoXHJcbiAgICogQHJldHVybnMge1Byb21pc2V9IC0gUmV0dXJucyB7QGxpbmsgVFhNZXRhfS5cclxuICAgKi9cclxuXHJcbiAgYXN5bmMgZ2V0TWV0YShoYXNoKSB7XHJcbiAgICBjb25zdCByYXcgPSBhd2FpdCB0aGlzLmRiLmdldChsYXlvdXQudC5lbmNvZGUoaGFzaCkpO1xyXG4gICAgaWYgKCFyYXcpXHJcbiAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgIGNvbnN0IHJlY29yZCA9IFR4UmVjb3JkLmZyb21SYXcocmF3KTtcclxuICAgIGNvbnN0IHtoZWlnaHQsIGluZGV4LCBvZmZzZXQsIGxlbmd0aH0gPSByZWNvcmQ7XHJcblxyXG4gICAgY29uc3QgYnJhdyA9IGF3YWl0IHRoaXMuZGIuZ2V0KGxheW91dC5iLmVuY29kZShoZWlnaHQpKTtcclxuICAgIGlmICghYnJhdylcclxuICAgICAgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgY29uc3QgYnJlY29yZCA9IEJsb2NrUmVjb3JkLmZyb21SYXcoYnJhdyk7XHJcbiAgICBjb25zdCB7YmxvY2ssIHRpbWV9ID0gYnJlY29yZDtcclxuXHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5ibG9ja3MucmVhZChibG9jaywgb2Zmc2V0LCBsZW5ndGgpO1xyXG5cclxuICAgIGNvbnN0IHR4ID0gVFguZnJvbVJhdyhkYXRhKTtcclxuXHJcbiAgICBjb25zdCBtZXRhID0gVFhNZXRhLmZyb21UWCh0eCk7XHJcbiAgICBtZXRhLmhlaWdodCA9IGhlaWdodDtcclxuICAgIG1ldGEuYmxvY2sgPSBibG9jaztcclxuICAgIG1ldGEudGltZSA9IHRpbWU7XHJcbiAgICBtZXRhLmluZGV4ID0gaW5kZXg7XHJcblxyXG4gICAgcmV0dXJuIG1ldGE7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXRyaWV2ZSBhIHRyYW5zYWN0aW9uLlxyXG4gICAqIEBwYXJhbSB7SGFzaH0gaGFzaFxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSAtIFJldHVybnMge0BsaW5rIFRYfS5cclxuICAgKi9cclxuXHJcbiAgYXN5bmMgZ2V0VFgoaGFzaCkge1xyXG4gICAgY29uc3QgbWV0YSA9IGF3YWl0IHRoaXMuZ2V0TWV0YShoYXNoKTtcclxuXHJcbiAgICBpZiAoIW1ldGEpXHJcbiAgICAgIHJldHVybiBudWxsO1xyXG5cclxuICAgIHJldHVybiBtZXRhLnR4O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtIYXNofSBoYXNoXHJcbiAgICogQHJldHVybnMge1Byb21pc2V9IC0gUmV0dXJucyBCb29sZWFuLlxyXG4gICAqL1xyXG5cclxuICBhc3luYyBoYXNUWChoYXNoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5kYi5oYXMobGF5b3V0LnQuZW5jb2RlKGhhc2gpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBjb2luIHZpZXdwb2ludCAoaGlzdG9yaWNhbCkuXHJcbiAgICogQHBhcmFtIHtUWH0gdHhcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gLSBSZXR1cm5zIHtAbGluayBDb2luVmlld30uXHJcbiAgICovXHJcblxyXG4gIGFzeW5jIGdldFNwZW50Vmlldyh0eCkge1xyXG4gICAgY29uc3QgdmlldyA9IGF3YWl0IHRoaXMuY2hhaW4uZ2V0Q29pblZpZXcodHgpO1xyXG5cclxuICAgIGZvciAoY29uc3Qge3ByZXZvdXR9IG9mIHR4LmlucHV0cykge1xyXG4gICAgICBpZiAodmlldy5oYXNFbnRyeShwcmV2b3V0KSlcclxuICAgICAgICBjb250aW51ZTtcclxuXHJcbiAgICAgIGNvbnN0IHtoYXNoLCBpbmRleH0gPSBwcmV2b3V0O1xyXG4gICAgICBjb25zdCBtZXRhID0gYXdhaXQgdGhpcy5nZXRNZXRhKGhhc2gpO1xyXG5cclxuICAgICAgaWYgKCFtZXRhKVxyXG4gICAgICAgIGNvbnRpbnVlO1xyXG5cclxuICAgICAgY29uc3Qge3R4LCBoZWlnaHR9ID0gbWV0YTtcclxuXHJcbiAgICAgIGlmIChpbmRleCA8IHR4Lm91dHB1dHMubGVuZ3RoKVxyXG4gICAgICAgIHZpZXcuYWRkSW5kZXgodHgsIGluZGV4LCBoZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB2aWV3O1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBUWEluZGV4ZXI7XHJcbiJdfQ==